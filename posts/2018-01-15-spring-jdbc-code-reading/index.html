<!DOCTYPE html>
<html lang="zh-cmn-Hans-CN" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8" />
    
    <head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.68.3" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="ffutop" />
  <meta property="og:url" content="https://www.ffutop.com/posts/2018-01-15-spring-jdbc-code-reading/" />
  <link rel="canonical" href="https://www.ffutop.com/posts/2018-01-15-spring-jdbc-code-reading/" /><link rel="apple-touch-icon" href="favicon.ico" />
  <link rel="icon" href="favicon.ico" />
  <link rel="shortcut" href="favicon.ico" /><link rel="alternate" type="application/atom+xml" href="https://www.ffutop.com/index.xml" title="Utop&#39;s Blog">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https://www.ffutop.com/"
      },
      "articleSection" : "posts",
      "name" : "Spring JDBC æºç å­¦ä¹ ",
      "headline" : "Spring JDBC æºç å­¦ä¹ ",
      "description" : "æ¦‚è§ˆ åœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚\n",
      "inLanguage" : "zh-cmn-Hans-CN",
      "author" : "ffutop",
      "creator" : "ffutop",
      "publisher": "ffutop",
      "accountablePerson" : "ffutop",
      "copyrightHolder" : "ffutop",
      "copyrightYear" : "2018",
      "datePublished": "2018-01-15T00:00:00Z",
      "dateModified" : "2018-01-15T00:00:00Z",
      "url" : "https://www.ffutop.com/posts/2018-01-15-spring-jdbc-code-reading/",
      "keywords" : [ "Spring","JDBC", ]
  }
</script>
<title>Spring JDBC æºç å­¦ä¹ </title>
  <meta property="og:title" content="Spring JDBC æºç å­¦ä¹ " />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="æ¦‚è§ˆ åœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚
" />
  <meta name="description" content="æ¦‚è§ˆ åœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚
" />
  <meta property="og:locale" content="zh-cmn-Hans-CN" />

  
    <style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:permanent marker,Impact,Charcoal,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin-left:auto;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-category{display:inline;font-weight:600;padding:2px 5px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.summary-read-more{color:#000}.summary-read-more:hover{color:#000}.pagination-prev{text-align:left;font-weight:700}.pagination-next{text-align:right;font-weight:700}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{text-align:center}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}</style>
  
  
    <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  

  

  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="Utop&#39;s Blog">
  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel="stylesheet">
  
  

  
  
</head>

     
  </head>
  <body>
    
  <article class="post Chinese" id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="header-title">
    <a href="/"
      >FFUTOP</a
    >
  </div>
  <div class="header-subtitle"></div>
</header>
<div class="row end-md center-xs header-items">
  
  <div class="header-item">
    <a href="/posts/" target="_blank">Posts</a>
  </div>
  
  <div class="header-item">
    <a href="/index.xml" target="_blank">RSS</a>
  </div>
  
  <div class="header-item">
    <a href="https://github.com/ffutop" target="_blank">Github</a>
  </div>
  
  <div class="header-item">
    <a href="/about/" target="_blank">About</a>
  </div>
  
</div>
<div class="row end-xs">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">Spring JDBC æºç å­¦ä¹ </h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2018-01-15 00:00:00 UTC">
                15 Jan 2018
              </time>
              
            </div>
            <div class="col-xs-6">
              
              <div class="post-author">
                <a target="_blank" href="https://www.ffutop.com/">@ffutop</a>
              </div>
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>åœ¨å­¦ä¹  Spring-JDBC ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ä» Java åŸç”Ÿæä¾›çš„ JDBC å¼€å§‹ï¼Œå¯¹ JDBC æ“ä½œçš„ä¸€æ•´å¥—å®Œæ•´çš„æµç¨‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">/**
</span><span style="color:#60a0b0;font-style:italic"> * copied from https://www.tutorialspoint.com/jdbc/jdbc-sample-code.htm
</span><span style="color:#60a0b0;font-style:italic"> * updated by DorMOUSENone
</span><span style="color:#60a0b0;font-style:italic"> */</span>

<span style="color:#60a0b0;font-style:italic">//STEP 1. å¼•å…¥å¿…é¡»çš„åŒ…
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">java.sql.*</span><span style="color:#666">;</span>

<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">Example</span> <span style="color:#666">{</span>
	<span style="color:#60a0b0;font-style:italic">// JDBC é©±åŠ¨å ä¸ DB URL 
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">final</span> String JDBC_DRIVER <span style="color:#666">=</span> <span style="color:#4070a0">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#666">;</span>  
    <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">final</span> String DB_URL <span style="color:#666">=</span> <span style="color:#4070a0">&#34;jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;dbName&gt;&#34;</span><span style="color:#666">;</span>

  	<span style="color:#60a0b0;font-style:italic">// æ•°æ®åº“ç™»å½•éªŒè¯ (ç”¨æˆ·åã€å¯†ç ç­‰)
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">final</span> String USER <span style="color:#666">=</span> <span style="color:#4070a0">&#34;username&#34;</span><span style="color:#666">;</span>
    <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">final</span> String PASS <span style="color:#666">=</span> <span style="color:#4070a0">&#34;password&#34;</span><span style="color:#666">;</span>
   
	<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#902000">void</span> <span style="color:#06287e">main</span><span style="color:#666">(</span>String<span style="color:#666">[]</span> args<span style="color:#666">)</span> <span style="color:#666">{</span>
		Connection conn <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
		Statement stmt <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
		<span style="color:#007020;font-weight:bold">try</span><span style="color:#666">{</span>
			<span style="color:#60a0b0;font-style:italic">//STEP 2: æ³¨å†Œé©±åŠ¨(æ³¨å†Œåˆ°é©±åŠ¨ç®¡ç†å™¨ DriverManager ç±»ä¸­)
</span><span style="color:#60a0b0;font-style:italic"></span>			Class<span style="color:#666">.</span><span style="color:#4070a0">forName</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#666">);</span>

            <span style="color:#60a0b0;font-style:italic">//STEP 3: åˆ›å»ºä¸€ä¸ªè¿æ¥
</span><span style="color:#60a0b0;font-style:italic"></span>          	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;Connecting to database...&#34;</span><span style="color:#666">);</span>
          	conn <span style="color:#666">=</span> DriverManager<span style="color:#666">.</span><span style="color:#4070a0">getConnection</span><span style="color:#666">(</span>DB_URL<span style="color:#666">,</span>USER<span style="color:#666">,</span>PASS<span style="color:#666">);</span>

          	<span style="color:#60a0b0;font-style:italic">//STEP 4: æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢
</span><span style="color:#60a0b0;font-style:italic"></span>          	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;Creating statement...&#34;</span><span style="color:#666">);</span>
          	stmt <span style="color:#666">=</span> conn<span style="color:#666">.</span><span style="color:#4070a0">createStatement</span><span style="color:#666">();</span>
          	String sql<span style="color:#666">;</span>
          	sql <span style="color:#666">=</span> <span style="color:#4070a0">&#34;SELECT id, first, last, age FROM Employees&#34;</span><span style="color:#666">;</span>
          	ResultSet rs <span style="color:#666">=</span> stmt<span style="color:#666">.</span><span style="color:#4070a0">executeQuery</span><span style="color:#666">(</span>sql<span style="color:#666">);</span>

          	<span style="color:#60a0b0;font-style:italic">//STEP 5: å°†ç»“æœä»ç»“æœé›†(ResultSet)ä¸­å–å‡º
</span><span style="color:#60a0b0;font-style:italic"></span>          	<span style="color:#007020;font-weight:bold">while</span><span style="color:#666">(</span>rs<span style="color:#666">.</span><span style="color:#4070a0">next</span><span style="color:#666">()){</span>
             	<span style="color:#60a0b0;font-style:italic">//æ ¹æ®åˆ—åé€ä¸€å–å‡ºæ•°æ®
</span><span style="color:#60a0b0;font-style:italic"></span>             	<span style="color:#902000">int</span> id  <span style="color:#666">=</span> rs<span style="color:#666">.</span><span style="color:#4070a0">getInt</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;id&#34;</span><span style="color:#666">);</span>
             	<span style="color:#902000">int</span> age <span style="color:#666">=</span> rs<span style="color:#666">.</span><span style="color:#4070a0">getInt</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;age&#34;</span><span style="color:#666">);</span>
             	String first <span style="color:#666">=</span> rs<span style="color:#666">.</span><span style="color:#4070a0">getString</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;first&#34;</span><span style="color:#666">);</span>
             	String last <span style="color:#666">=</span> rs<span style="color:#666">.</span><span style="color:#4070a0">getString</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;last&#34;</span><span style="color:#666">);</span>

             	<span style="color:#60a0b0;font-style:italic">//å±•ç¤ºç»“æœ
</span><span style="color:#60a0b0;font-style:italic"></span>             	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">print</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;ID: &#34;</span> <span style="color:#666">+</span> id<span style="color:#666">);</span>
             	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">print</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;, Age: &#34;</span> <span style="color:#666">+</span> age<span style="color:#666">);</span>
             	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">print</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;, First: &#34;</span> <span style="color:#666">+</span> first<span style="color:#666">);</span>
             	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;, Last: &#34;</span> <span style="color:#666">+</span> last<span style="color:#666">);</span>
          	<span style="color:#666">}</span>
          	<span style="color:#60a0b0;font-style:italic">//STEP 6: æ¸…ç†ç¯å¢ƒ
</span><span style="color:#60a0b0;font-style:italic"></span>          	rs<span style="color:#666">.</span><span style="color:#4070a0">close</span><span style="color:#666">();</span>
          	stmt<span style="color:#666">.</span><span style="color:#4070a0">close</span><span style="color:#666">();</span>
          	conn<span style="color:#666">.</span><span style="color:#4070a0">close</span><span style="color:#666">();</span>
       	<span style="color:#666">}</span><span style="color:#007020;font-weight:bold">catch</span><span style="color:#666">(</span>SQLException se<span style="color:#666">){</span>
          	<span style="color:#60a0b0;font-style:italic">//å¤„ç† JDBC é”™è¯¯
</span><span style="color:#60a0b0;font-style:italic"></span>          	se<span style="color:#666">.</span><span style="color:#4070a0">printStackTrace</span><span style="color:#666">();</span>
       	<span style="color:#666">}</span><span style="color:#007020;font-weight:bold">catch</span><span style="color:#666">(</span>Exception e<span style="color:#666">){</span>
          	<span style="color:#60a0b0;font-style:italic">//å¤„ç† Class.forName() å¼•èµ·çš„é”™è¯¯
</span><span style="color:#60a0b0;font-style:italic"></span>          	e<span style="color:#666">.</span><span style="color:#4070a0">printStackTrace</span><span style="color:#666">();</span>
       	<span style="color:#666">}</span><span style="color:#007020;font-weight:bold">finally</span><span style="color:#666">{</span>
          	<span style="color:#60a0b0;font-style:italic">// finally ä»£ç åº“æ¥å…³é—­èµ„æº
</span><span style="color:#60a0b0;font-style:italic"></span>          	<span style="color:#007020;font-weight:bold">try</span><span style="color:#666">{</span>
            	<span style="color:#007020;font-weight:bold">if</span><span style="color:#666">(</span>stmt<span style="color:#666">!=</span><span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span>
                	stmt<span style="color:#666">.</span><span style="color:#4070a0">close</span><span style="color:#666">();</span>
          	<span style="color:#666">}</span><span style="color:#007020;font-weight:bold">catch</span><span style="color:#666">(</span>SQLException se2<span style="color:#666">){</span>
          	<span style="color:#666">}</span><span style="color:#60a0b0;font-style:italic">// ä¸åšä»»ä½•å¤„ç†
</span><span style="color:#60a0b0;font-style:italic"></span>          	<span style="color:#007020;font-weight:bold">try</span><span style="color:#666">{</span>
           		<span style="color:#007020;font-weight:bold">if</span><span style="color:#666">(</span>conn<span style="color:#666">!=</span><span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span>
                	conn<span style="color:#666">.</span><span style="color:#4070a0">close</span><span style="color:#666">();</span>
            <span style="color:#666">}</span><span style="color:#007020;font-weight:bold">catch</span><span style="color:#666">(</span>SQLException se<span style="color:#666">){</span>
               	se<span style="color:#666">.</span><span style="color:#4070a0">printStackTrace</span><span style="color:#666">();</span>
            <span style="color:#666">}</span>
       	<span style="color:#666">}</span>
       	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;Goodbye!&#34;</span><span style="color:#666">);</span>
	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>ä»ä¸Šé¢çš„é€šç”¨ JDBC ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨ Java åŸç”Ÿæä¾›çš„ java.sql.* åŒ…å¯ä»¥å®Œæˆæ³¨å†Œé©±åŠ¨ï¼Œåˆ›å»ºè¿æ¥ï¼Œæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¤„ç†ç»“æœç­‰ä¸€ç³»åˆ—ä¸€æ•´å¥—æ“ä½œã€‚</p>
<p>è€Œ Spring-JDBC å¯¹äº Java åŸç”Ÿæä¾›çš„ JDBC ï¼Œå¯¹ä¸€ç³»åˆ—æ•°æ®åŠæ“ä½œè¿›è¡Œäº†æ•´åˆï¼š</p>
<ol>
<li>å®ç°äº† DataSource æ¥å£ï¼Œç”¨äºæ•´åˆæ•°æ®æºé…ç½®ï¼Œå°†å„ç§é›¶æ•£çš„å±æ€§å€¼ï¼ˆè¯¸å¦‚ URLã€ç”¨æˆ·åã€ å¯†ç ç­‰ï¼‰æ•´åˆæˆå®Œæ•´çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¾¿äºé‡ç”¨ï¼›ä¹Ÿå®ç°äº† getConnection(â€¦) æ¥å£ï¼Œä¾¿äºç›´æ¥é€šè¿‡ DataSource è·å–è¿æ¥ã€‚</li>
<li>å¯¹æ‰§è¡ŒæŸ¥è¯¢çš„æµç¨‹è¿›è¡Œäº†å°è£…ã€‚</li>
<li>å¯¹ç»“æœé›†çš„å¤„ç†æä¾›äº†å¤šç§æ¥å£ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯å¯è‡ªç”±é€‰æ‹©æ‰€å¿…é¡»çš„å®ç°ç±»ã€‚ä¾‹å¦‚ç›´æ¥é€šè¿‡ JDBC è·å¾— Bean ï¼Œè€Œæ— éœ€å¦‚ä¸Šä¾‹ 39-42 è¡Œæ‰€ç¤ºï¼Œé€ä¸€ç¼–ç è¿›è¡Œæå–ã€‚</li>
</ol>
<p>æœ¬èŠ‚æä¾›å¯¹ã€ŠSpring-JDBC æºç å­¦ä¹ ã€‹å®Œæ•´å­¦ä¹ è¿‡ç¨‹çš„ä¸€ä¸ªæ¢³ç†ï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/dormousenone/article/details/79035440">JdbcTemplate</a> ä¸€èŠ‚ä½œä¸ºå­¦ä¹  Spring-jdbc çš„åˆ‡å…¥ç‚¹ï¼Œæ˜¯ org.springframework.jdbc.core åŒ…ä¸­çš„æ ¸å¿ƒç±»ï¼Œæ˜¯ä¸€ä¸ªæä¾›ä¸åŒåœºæ™¯ä¸‹æ•°æ®åº“æ“ä½œçš„æ¨¡æ¿ç±»ã€‚ä¸»è¦æè¿°å…¶æŒæœ‰çš„å±æ€§ DataSource ç­‰ä»¥åŠå…¶å®ç°çš„æ–¹æ³•ã€‚</li>
<li><a href="https://blog.csdn.net/dormousenone/article/details/79037012">DataSource</a> ä¸€èŠ‚æ‰¿æ¥ JdbcTemplate ä¸€èŠ‚ï¼Œæä¾› Spring-jdbc å¯¹æ•°æ®æºçš„ä¸€ä¸ªåŒ…è£…ä¸åº”ç”¨ã€‚åŒæ—¶æè¿°å…¶æ ¸å¿ƒæ–¹æ³• getConnection(â€¦) çš„å®ç°ã€‚</li>
<li><a href="https://blog.csdn.net/dormousenone/article/details/79042212">DriverManager</a> æè¿°å…¶å¯¹ä¸åŒæ•°æ®åº“ä¾›åº”å•†æä¾›çš„é©±åŠ¨çš„ç®¡ç†ä¸ä½¿ç”¨æ–¹æ³•ã€‚åŒæ—¶ç®€å•æè¿°é€šè¿‡å…·ä½“é©±åŠ¨è·å¾—ä¸€ä¸ªè¿æ¥çš„å®ç°ã€‚</li>
<li><a href="https://blog.csdn.net/dormousenone/article/details/79046865">PreparedStatement &amp; CallableStatement</a> ä¸€èŠ‚ä¸»è¦è¡¨è¿° Spring-jdbc å¦‚ä½•å¯¹æ‰§è¡ŒæŸ¥è¯¢çš„æµç¨‹è¿›è¡Œäº†å°è£…ã€‚ç‰¹åˆ«æ˜¯å¯¹äº PreparedStatement ä¸ CallableStatement è¿™ç±»é¢„ç½®å¯å˜ SQL è¯­å¥ï¼Œåœ¨æ‰§è¡Œå‰å¿…é¡»å¯¹å…¶ä¸­å¯å˜å‚æ•°è¿›è¡Œè¡¥å…¨çš„ Statement ã€‚</li>
<li><a href="https://blog.csdn.net/dormousenone/article/details/79062275">ResultSet</a> æè¿° Spring-jdbc å¦‚ä½•å¯¹ç»“æœé›†è¿›è¡Œå¤„ç†ï¼Œæä¾›äº†å¤šç§ä¸åŒçš„æ¥å£å®ç°ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚è¿™ç§å°è£…åçš„æ“ä½œå¯ä»¥æå¤§åœ°ç®€åŒ–ç›´æ¥ä½¿ç”¨ Java åŸç”Ÿ JDBC æ‰€å¿…é¡»çš„ç¡¬ç¼–ç æå–æ•°æ®çš„é—®é¢˜ã€‚</li>
</ol>
<h2 id="jdbctemplate">JdbcTemplate</h2>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fn90ghu9ufj30ki0jm75t.jpg" alt=""></p>
<p>JdbcTemplate ç±»ä½œä¸º org.springframework.core åŒ…ä¸‹çš„æ ¸å¿ƒç±»ï¼Œå¯¹ Java å®ç°çš„ JDBC è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ï¼Œå¯ä»¥ç®€åŒ– JDBC çš„ä½¿ç”¨ï¼ŒåŒæ—¶é¿å…è®¸å¤šå¸¸è§çš„é”™è¯¯ã€‚ç”±è¯¥ç±»æ¥æ‰§è¡Œ JDBC å·¥ä½œæµï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦æä¾› SQL è¯­å¥å°±å¯ä»¥è·å¾— DB æ‰§è¡Œç»“æœï¼ˆğŸ˜€ï¼Œå½“ç„¶å®é™…æ“ä½œä¸Šæ²¡æœ‰æè¿°çš„è¿™ä¹ˆç®€å•ï¼‰ã€‚</p>
<p><strong>ä½¿ç”¨ JdbcTemplate ç±»åªéœ€è¦å®ç°ä¸¤ä¸ªå›è°ƒæ¥å£ PreparedStatementCreator (åˆ›å»ºä¸€ä¸ª PreparedStatementï¼Œç»™å®šè¿æ¥ï¼Œæä¾› SQL è¯­å¥ä»¥åŠå¿…è¦çš„å‚æ•°), ResultSetExtractor (ç”¨äºèŠ±å¼è·å–ç»“æœé›†)ã€‚å½“ç„¶ï¼Œä¸å®ç°ä¸Šè¿°ä¸¤ä¸ªæ¥å£ä¹Ÿå¯ä»¥è¿›è¡Œç®€å•çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚åªé€šè¿‡ JdbcTemplate è·å–ä¸€ä¸ªè¿æ¥(Connection) æˆ–è€…æ‰§è¡Œä¸€ä¸ªé™æ€ SQL Updateã€‚</strong></p>
<p><em>çœ‹ä¸æ‡‚æ— æ‰€è°“ï¼Œå…ˆç»§ç»­å‘ä¸‹çœ‹ï¼Œä¼šåšæ›´è¯¦ç»†çš„è®²è§£ã€‚</em></p>
<h3 id="jdbcaccessor">JdbcAccessor</h3>
<p>é¦–å…ˆäº†è§£ JdbcTemplate çš„å®ç°ï¼ŒJdbcTemplate ç»§æ‰¿äº† JdbcAccessor æŠ½è±¡ç±»ï¼Œè¯¥æŠ½è±¡ç±»æœ‰ä¸¤ä¸ªä¸»è¦å±æ€§â€”â€” <strong>DataSource dataSource</strong> &amp; <strong>SQLExceptionTranslator exceptionTranslator</strong> ï¼Œä»¥åŠä¸€ä¸ªæ‡’åŠ è½½æ ‡è¯†ç¬¦ <strong>lazyInit</strong> ã€‚</p>
<p>å…¶ä¸­ï¼Œ</p>
<ul>
<li>DataSource å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨æœ‰ä¸æ•°æ®åº“ç›¸å…³çš„å±æ€§å®ä¾‹ï¼Œä¸»è¦æ–¹æ³•åŒ…æ‹¬ <code>Connection getConnection()</code> &amp; <code>Connection getConnection(String username, String password)</code> ã€‚</li>
<li>SQLExceptionTranslator åˆ©ç”¨ç­–ç•¥æ¨¡å¼å°† Java å®šä¹‰çš„ SQLException è½¬æ¢æˆ Spring å£°æ˜çš„ DataAccessExceptionã€‚</li>
</ul>
<p>JdbcAccessor å®ç°çš„ InitializingBean æ¥å£ï¼ŒInitializingBean æ¥å£ä¸º Bean æä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–å®ä¾‹çš„æ–¹æ³• â€”â€” afterPropertiesSet() æ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œä¸€èˆ¬éƒ½åœ¨ç±»æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œè¯¥æ–¹æ³•ã€‚åŒæ ·çš„ï¼Œå£°æ˜åˆå§‹åŒ–å®ä¾‹è°ƒç”¨çš„æ–¹æ³•è¿˜å¯é‡‡ç”¨ <code>&lt;bean id=&quot;&quot; class=&quot;&quot; init-method=&quot;myInitMethod&quot;/&gt;</code> åœ¨åˆå§‹åŒ– bean æ—¶æ‰§è¡Œ myInitMethod() æ–¹æ³•ã€‚å…·ä½“æ‰§è¡Œé¡ºåºä¸º ï¼š</p>
<ol>
<li>bean çš„å±æ€§æ³¨å…¥</li>
<li>è°ƒç”¨ afterPropertiesSet() æ–¹æ³•</li>
<li>æ‰§è¡Œ myInitMethod() æ–¹æ³•</li>
</ol>
<p>æ­¤å¤„ç»§æ‰¿è¯¥æ¥å£æ˜¯ä¸ºäº†å®ç° DataSource éªŒè¯ä»¥åŠ SQLExceptionTranslator çš„æ‡’åŠ è½½ OR NOT çš„é€‰æ‹©ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#555;font-weight:bold">@Override</span>
<span style="color:#007020;font-weight:bold">public</span> <span style="color:#902000">void</span> <span style="color:#06287e">afterPropertiesSet</span><span style="color:#666">()</span> <span style="color:#666">{</span>
	<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>getDataSource<span style="color:#666">()</span> <span style="color:#666">==</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>	<span style="color:#60a0b0;font-style:italic">// åˆ¤æ–­æ˜¯å¦æ³¨å…¥äº† DataSource
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#007020;font-weight:bold">throw</span> <span style="color:#007020;font-weight:bold">new</span> IllegalArgumentException<span style="color:#666">(</span><span style="color:#4070a0">&#34;Property &#39;dataSource&#39; is required&#34;</span><span style="color:#666">);</span>
	<span style="color:#666">}</span>
	<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(!</span>isLazyInit<span style="color:#666">())</span> <span style="color:#666">{</span>	<span style="color:#60a0b0;font-style:italic">// æ ¹æ®æ‡’åŠ è½½æ ‡è¯†ç¬¦é€‰æ‹©æ‰§è¡Œä¸å¦
</span><span style="color:#60a0b0;font-style:italic"></span>		getExceptionTranslator<span style="color:#666">();</span>	<span style="color:#60a0b0;font-style:italic">// è·å–ä¸€ä¸ª SQLExceptionTranslator å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>è¯¥æ–¹æ³•åœ¨ BeanFactory å®Œæˆè¯¥ bean çš„ä¾èµ–æ³¨å…¥åæ‰§è¡Œï¼Œå°†é¦–å…ˆåˆ¤æ–­ DataSource æ˜¯å¦å·²ç»è¢«æ³¨å…¥ï¼Œå†æ ¹æ®æ‡’åŠ è½½æ ‡è¯†ç¬¦æ¥å†³å®šæ˜¯å¦å®ä¾‹åŒ–ä¸€ä¸ª SQLExceptionTranslator ã€‚</p>
<h3 id="jdbcoperations">JdbcOperations</h3>
<p>åŒæ—¶ï¼ŒJdbcTemplate ç±»å®ç°äº† JdbcOperations æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†åŸºæœ¬çš„ JDBC æ“ä½œã€‚åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>&lt;T&gt; T execute(ConnectionCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(StatementCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(PreparedStatementCreator psc, PreparedStatementCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(CallableStatementCreator csc, CallableStatementCallback&lt;T&gt; action);</code></li>
</ol>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fncp2ncqd6j31j00au0uv.jpg" alt=""></p>
<p>å…¶å®ƒçš„ execute(â€¦) , query(â€¦), update(â€¦) ç­‰æœ€ç»ˆéƒ½å°†è°ƒç”¨ä¸Šè¿° 4 ç§æ–¹æ³•å…¶ä¸€æ¥å®Œæˆç›®çš„ã€‚</p>
<p>è¯¦ç»†è§‚å¯Ÿä¸Šè¿°æ–¹æ³•çš„å…¥å‚ï¼Œ ConnectionCallback, StatementCallback, PreparedStatementCallback å’Œ CallableStatementCallback å››ä¸ª Callback æ¥å£ï¼Œåˆ†åˆ«éƒ½æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå…¶ä¸­çš„å”¯ä¸€æ–¹æ³• doInXXX() å°†åœ¨ execute() ä¸­è¢«è°ƒç”¨ï¼Œä»¥æ­¤å®ç°è·å¾— ResultSet å¹¶è¿”å› Result ã€‚execute ä¸­è°ƒç”¨ doInXXX() çš„é€šç”¨ä»£ç å¦‚ä¸‹ ï¼ˆä»¥ Statement ä¸ºä¾‹ï¼‰ï¼š</p>
<p><em>å¯¹äºä¸ç†è§£<strong>å›è°ƒ</strong>çš„åŒå­¦ï¼Œè¯·è‡ªè¡Œäº†è§£æ¦‚å¿µ</em></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> T <span style="color:#06287e">execute</span><span style="color:#666">(</span>StatementCallback<span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> action<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> DataAccessException <span style="color:#666">{</span>
	<span style="color:#60a0b0;font-style:italic">// é€šè¿‡å·¥å…·ç±» DataSourceUtils è·å–ä¸€ä¸ªè¿æ¥
</span><span style="color:#60a0b0;font-style:italic"></span>  	Connection con <span style="color:#666">=</span> DataSourceUtils<span style="color:#666">.</span><span style="color:#4070a0">getConnection</span><span style="color:#666">(</span>obtainDataSource<span style="color:#666">());</span>
  	<span style="color:#60a0b0;font-style:italic">// ä¸€ä¸ª Statement ç©ºå®ä¾‹ï¼ŒPreparedStatement, CallableStatement ç±»ä¼¼
</span><span style="color:#60a0b0;font-style:italic"></span>	Statement stmt <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
	<span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
		stmt <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">createStatement</span><span style="color:#666">();</span>	<span style="color:#60a0b0;font-style:italic">// é€šè¿‡è¿æ¥(Connection)è·å–ä¸€ä¸ª Statement
</span><span style="color:#60a0b0;font-style:italic"></span>		applyStatementSettings<span style="color:#666">(</span>stmt<span style="color:#666">);</span>	<span style="color:#60a0b0;font-style:italic">// é…ç½® Statement å‚æ•°
</span><span style="color:#60a0b0;font-style:italic"></span>      	<span style="color:#60a0b0;font-style:italic">// å›è°ƒæ‰§è¡Œ doInXXX() æ–¹æ³•, å¹¶è·å¾— result
</span><span style="color:#60a0b0;font-style:italic"></span>		T result <span style="color:#666">=</span> action<span style="color:#666">.</span><span style="color:#4070a0">doInStatement</span><span style="color:#666">(</span>stmt<span style="color:#666">);</span>	
		handleWarnings<span style="color:#666">(</span>stmt<span style="color:#666">);</span>
		<span style="color:#007020;font-weight:bold">return</span> result<span style="color:#666">;</span>
	<span style="color:#666">}</span>
	<span style="color:#007020;font-weight:bold">catch</span> <span style="color:#666">(</span>SQLException ex<span style="color:#666">)</span> <span style="color:#666">{</span>
		<span style="color:#60a0b0;font-style:italic">// Release Connection early, to avoid potential connection pool deadlock
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#60a0b0;font-style:italic">// in the case when the exception translator hasn&#39;t been initialized yet.
</span><span style="color:#60a0b0;font-style:italic"></span>		String sql <span style="color:#666">=</span> getSql<span style="color:#666">(</span>action<span style="color:#666">);</span>
		JdbcUtils<span style="color:#666">.</span><span style="color:#4070a0">closeStatement</span><span style="color:#666">(</span>stmt<span style="color:#666">);</span>
		stmt <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
		DataSourceUtils<span style="color:#666">.</span><span style="color:#4070a0">releaseConnection</span><span style="color:#666">(</span>con<span style="color:#666">,</span> getDataSource<span style="color:#666">());</span>
		con <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
		<span style="color:#007020;font-weight:bold">throw</span> translateException<span style="color:#666">(</span><span style="color:#4070a0">&#34;StatementCallback&#34;</span><span style="color:#666">,</span> sql<span style="color:#666">,</span> ex<span style="color:#666">);</span>
	<span style="color:#666">}</span>
	<span style="color:#007020;font-weight:bold">finally</span> <span style="color:#666">{</span>
		JdbcUtils<span style="color:#666">.</span><span style="color:#4070a0">closeStatement</span><span style="color:#666">(</span>stmt<span style="color:#666">);</span>
		DataSourceUtils<span style="color:#666">.</span><span style="color:#4070a0">releaseConnection</span><span style="color:#666">(</span>con<span style="color:#666">,</span> getDataSource<span style="color:#666">());</span>
	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>å¯¹äº Statement, PreparedStatement, CallableStatement çš„åŒºåˆ«ï¼Œé¦–å…ˆä¸‹å›¾è¡¨ç°äº†ä¸‰ä¸ªæ¥å£çš„ç»§æ‰¿å…³ç³»ã€‚</p>
<ul>
<li>Statement å¯ä»¥æ”¯æŒé™æ€ SQL è¯­å¥</li>
<li>PreparedStatement æ”¯æŒå¯å˜å‚æ•°çš„ SQL è¯­å¥</li>
<li>CallableStatement æ”¯æŒå¯å˜å‚æ•°çš„ SQL è¯­å¥ï¼Œå¹¶ä¸”æ”¯æŒå®šåˆ¶ DB çš„è¾“å‡ºç»“æœ</li>
</ul>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fncpaec17yj30ew0hcdh7.jpg" alt=""></p>
<h2 id="datasource">DataSource</h2>
<p>ä¸Šä¸€èŠ‚åœ¨ç²—ç•¥åœ°äº†è§£äº† JdbcTemplate æä¾›çš„æ–¹æ³•ä¹‹åï¼Œä¸‹é¢å…ˆæ¥å¯¹ DataSource åšä¸€ç‚¹äº†è§£ã€‚</p>
<h3 id="java-æä¾›çš„-datasource-å®šä¹‰">Java æä¾›çš„ DataSource å®šä¹‰</h3>
<p>DataSource æ˜¯ Java æ ¸å¿ƒåº“æä¾›çš„æ¥å£ã€‚ä½äº javax.sql package ä¸‹ã€‚</p>
<p>DataSource æ¥å£å¯ä»¥è¢«è§†ä½œæ˜¯ä¸€ä¸ªæä¾›ç‰©ç† DB å®ä¾‹è¿æ¥(Connection) çš„å·¥å‚ï¼Œé€šè¿‡ DataSource æŒæœ‰çš„å„ç§å±æ€§ï¼ˆåŒ…æ‹¬ DB Url, Username, Password ç­‰ï¼‰æ¥è·å–ä¸€ä¸ªè¿æ¥(Connection) ã€‚DataSource æ¥å£æœ‰ä¸‰ç§ä¸åŒçš„å®ç°æ–¹æ¡ˆï¼š</p>
<ol>
<li>æœ€åŸºæœ¬çš„å®ç°â€”â€”ç”Ÿäº§ä¸€ä¸ªæ ‡å‡†è¿æ¥(Connection) å¯¹è±¡</li>
<li>è¿æ¥æ± æ–¹æ¡ˆâ€”â€”ç”Ÿäº§ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°è¿æ¥æ± çš„å¯¹è±¡</li>
<li>åˆ†å¸ƒå¼äº‹ç‰©å®ç°â€”â€”ç”Ÿäº§ä¸€ä¸ªå¯ä»¥æ”¯æŒåˆ†å¸ƒå¼äº‹ç‰©ï¼Œå¹¶é»˜è®¤è¢«æ·»åŠ åˆ°è¿æ¥æ± çš„è¿æ¥å¯¹è±¡</li>
</ol>
<p>åŒ…æ‹¬ä¸¤ä¸ªå¯¹å¤–æä¾›è¿æ¥(Connection) å¯¹è±¡çš„æ–¹æ³•ï¼Œ</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Connection <span style="color:#06287e">getConnection</span><span style="color:#666">()</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException<span style="color:#666">;</span>
Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>String username<span style="color:#666">,</span> String password<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException<span style="color:#666">;</span>
</code></pre></div><p>å…¶çˆ¶æ¥å£ CommonDataSource æä¾›è®¾ç½®/è·å– LogWriterï¼Œç™»å½• DB è¶…æ—¶æ—¶é—´å’Œè·å–çˆ¶ Logger çš„æ–¹æ³•ã€‚</p>
<h3 id="spring-jdbc-æ‰©å±•çš„-datasource-å®šä¹‰">Spring-JDBC æ‰©å±•çš„ DataSource å®šä¹‰</h3>
<p>åœ¨ Spring-jdbc ä¸‹ï¼ŒDataSources æœ€é¡¶çº§çš„ç±»æ˜¯ AbstractDataSource ï¼Œå¯¹ DataSource çš„æ‰€æœ‰çˆ¶æ¥å£æ–¹æ³•åšäº†å®ç°ã€‚ä½†ä¿ç•™ getConnection() æ–¹æ³•ç”±å­ç±»å®ç°ã€‚</p>
<p>åœ¨ AbstractDriverBasedDataSource ä¸­ï¼Œå®šä¹‰äº†å¤§é‡çš„å‚æ•°ï¼Œè¯¸å¦‚ url, username ç­‰ï¼Œè¿™äº›éƒ½è¢«ç”¨æ¥å®šä½å¹¶å®šä¹‰ä¸æ•°æ®åº“å®ä¾‹çš„è¿æ¥ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">abstract</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">AbstractDriverBasedDataSource</span> <span style="color:#007020;font-weight:bold">extends</span> AbstractDataSource <span style="color:#666">{</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#007020;font-weight:bold">private</span> String url<span style="color:#666">;</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#007020;font-weight:bold">private</span> String username<span style="color:#666">;</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#007020;font-weight:bold">private</span> String password<span style="color:#666">;</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#007020;font-weight:bold">private</span> String catalog<span style="color:#666">;</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#007020;font-weight:bold">private</span> String schema<span style="color:#666">;</span>

   <span style="color:#555;font-weight:bold">@Nullable</span>
   <span style="color:#60a0b0;font-style:italic">// å¯ä»¥çœ‹åˆ°æ­¤å¤„æœ‰ä¸€ä¸ª Properties ç±»
</span><span style="color:#60a0b0;font-style:italic"></span>   <span style="color:#007020;font-weight:bold">private</span> Properties connectionProperties<span style="color:#666">;</span>
   
   <span style="color:#60a0b0;font-style:italic">// çœç•¥è‹¥å¹²æ–¹æ³•
</span><span style="color:#60a0b0;font-style:italic"></span>  

	<span style="color:#555;font-weight:bold">@Override</span>
	<span style="color:#007020;font-weight:bold">public</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">()</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
      	<span style="color:#60a0b0;font-style:italic">// è°ƒç”¨å†…éƒ¨æ–¹æ³• getConnectionFromDriver()
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#007020;font-weight:bold">return</span> getConnectionFromDriver<span style="color:#666">(</span>getUsername<span style="color:#666">(),</span> getPassword<span style="color:#666">());</span>
	<span style="color:#666">}</span>

	<span style="color:#555;font-weight:bold">@Override</span>
	<span style="color:#007020;font-weight:bold">public</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>String username<span style="color:#666">,</span> String password<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
      	<span style="color:#60a0b0;font-style:italic">// è°ƒç”¨å†…éƒ¨æ–¹æ³• getConnectionFromDriver()
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#007020;font-weight:bold">return</span> getConnectionFromDriver<span style="color:#666">(</span>username<span style="color:#666">,</span> password<span style="color:#666">);</span>
	<span style="color:#666">}</span>
  
   <span style="color:#60a0b0;font-style:italic">// å®šä¹‰äº†ä¸€ä¸ªè·å– Connection çš„æ–¹æ³•ï¼Œç”± getConnection() æ–¹æ³•è°ƒç”¨ï¼Œ
</span><span style="color:#60a0b0;font-style:italic"></span>   <span style="color:#60a0b0;font-style:italic">// æ­¤æ–¹æ³•ä¸»è¦æ˜¯å°†å±æ€§åšäº†ä¸€ä¸ªæ•´åˆ
</span><span style="color:#60a0b0;font-style:italic"></span>   <span style="color:#60a0b0;font-style:italic">// å…·ä½“è·å– Connection çš„é€»è¾‘ä»ç„¶ä¸‹æ”¾åˆ°å­ç±»å®ç° è§ 40 è¡Œ
</span><span style="color:#60a0b0;font-style:italic"></span>   <span style="color:#007020;font-weight:bold">protected</span> Connection <span style="color:#06287e">getConnectionFromDriver</span><span style="color:#666">(</span><span style="color:#555;font-weight:bold">@Nullable</span> String username<span style="color:#666">,</span> <span style="color:#555;font-weight:bold">@Nullable</span> String password<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
		Properties mergedProps <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> Properties<span style="color:#666">();</span>
		Properties connProps <span style="color:#666">=</span> getConnectionProperties<span style="color:#666">();</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>connProps <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
			mergedProps<span style="color:#666">.</span><span style="color:#4070a0">putAll</span><span style="color:#666">(</span>connProps<span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>username <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
			mergedProps<span style="color:#666">.</span><span style="color:#4070a0">setProperty</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;user&#34;</span><span style="color:#666">,</span> username<span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>password <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
			mergedProps<span style="color:#666">.</span><span style="color:#4070a0">setProperty</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;password&#34;</span><span style="color:#666">,</span> password<span style="color:#666">);</span>
		<span style="color:#666">}</span>
		
     	<span style="color:#60a0b0;font-style:italic">// è·å– Connection é€»è¾‘ä¸‹æ”¾
</span><span style="color:#60a0b0;font-style:italic"></span>		Connection con <span style="color:#666">=</span> getConnectionFromDriver<span style="color:#666">(</span>mergedProps<span style="color:#666">);</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">catalog</span> <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
			con<span style="color:#666">.</span><span style="color:#4070a0">setCatalog</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">catalog</span><span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">schema</span> <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
			con<span style="color:#666">.</span><span style="color:#4070a0">setSchema</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">schema</span><span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">return</span> con<span style="color:#666">;</span>
	<span style="color:#666">}</span>
  
  	<span style="color:#60a0b0;font-style:italic">// è¯¥ç±»ä¸­è·å– Connection çš„æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">protected</span> <span style="color:#007020;font-weight:bold">abstract</span> Connection <span style="color:#06287e">getConnectionFromDriver</span><span style="color:#666">(</span>Properties props<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException<span style="color:#666">;</span>

<span style="color:#666">}</span>
</code></pre></div><p>æ•´åˆæ–¹æ¡ˆä¸ºå°†é™¤ url å¤–çš„æ‰€æœ‰å‚æ•°æ•´åˆåœ¨åŒä¸€ä¸ª Properties å¯¹è±¡ä¸­ (å…¶ä¸­ï¼ŒProperties å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Hash Map) ã€‚æœ€ç»ˆè°ƒç”¨ <code>Connection getConnectionFromDriver(Properties props)</code> è·å–è¿æ¥ã€‚</p>
<p>AbstractDriverBasedDataSource æŠ½è±¡ç±»çš„ä¸¤ä¸ªå­ç±» DriverManagerDataSource å’Œ SimpleDriverDataSource éƒ½ä»¥ä¸åŒæ–¹å¼è·å¾—äº†è¿æ¥(Connection)ï¼Œä½†æ€»ç»“è€Œè¨€ï¼Œè·å–è¿æ¥(Connection) çš„ä»»åŠ¡è¢«å§”æ‰˜ç»™äº† Driver æ¥å®ç°ï¼ˆå…¶ä¸­ï¼ŒDriver æœ‰ Java å®šä¹‰æ¥å£ï¼Œå¹¶ç”±å„æ•°æ®åº“æä¾›å•†æä¾›ï¼Œä¾‹å¦‚ MySQL æä¾›äº† mysql-connector-java-XXX.jar æ¥å®Œæˆé’ˆå¯¹ç›¸åº”æ•°æ®åº“çš„å…·ä½“å®ç°ï¼‰ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// ----------------------------
</span><span style="color:#60a0b0;font-style:italic">// SimpleDriverDataSource çš„å®ç°
</span><span style="color:#60a0b0;font-style:italic">// ----------------------------
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#555;font-weight:bold">@Override</span>
<span style="color:#007020;font-weight:bold">protected</span> Connection <span style="color:#06287e">getConnectionFromDriver</span><span style="color:#666">(</span>Properties props<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
	Driver driver <span style="color:#666">=</span> getDriver<span style="color:#666">();</span>
	String url <span style="color:#666">=</span> getUrl<span style="color:#666">();</span>
	Assert<span style="color:#666">.</span><span style="color:#4070a0">notNull</span><span style="color:#666">(</span>driver<span style="color:#666">,</span> <span style="color:#4070a0">&#34;Driver must not be null&#34;</span><span style="color:#666">);</span>
	<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>logger<span style="color:#666">.</span><span style="color:#4070a0">isDebugEnabled</span><span style="color:#666">())</span> <span style="color:#666">{</span>
		logger<span style="color:#666">.</span><span style="color:#4070a0">debug</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;Creating new JDBC Driver Connection to [&#34;</span> <span style="color:#666">+</span> url <span style="color:#666">+</span> <span style="color:#4070a0">&#34;]&#34;</span><span style="color:#666">);</span>
	<span style="color:#666">}</span>
  	<span style="color:#60a0b0;font-style:italic">// å“ˆå“ˆï¼Œé‡ç‚¹åœ¨è¿™... driver åœ¨è¯¥ç±»ä¸­è¢«é¢„å…ˆæ³¨å…¥
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">return</span> driver<span style="color:#666">.</span><span style="color:#4070a0">connect</span><span style="color:#666">(</span>url<span style="color:#666">,</span> props<span style="color:#666">);</span>
<span style="color:#666">}</span>

<span style="color:#60a0b0;font-style:italic">// -----------------------------
</span><span style="color:#60a0b0;font-style:italic">// DriverManagerDataSource çš„å®ç°
</span><span style="color:#60a0b0;font-style:italic">// -----------------------------
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#555;font-weight:bold">@Override</span>
<span style="color:#007020;font-weight:bold">protected</span> Connection <span style="color:#06287e">getConnectionFromDriver</span><span style="color:#666">(</span>Properties props<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
	String url <span style="color:#666">=</span> getUrl<span style="color:#666">();</span>
	Assert<span style="color:#666">.</span><span style="color:#4070a0">state</span><span style="color:#666">(</span>url <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">,</span> <span style="color:#4070a0">&#34;&#39;url&#39; not set&#34;</span><span style="color:#666">);</span>
	<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>logger<span style="color:#666">.</span><span style="color:#4070a0">isDebugEnabled</span><span style="color:#666">())</span> <span style="color:#666">{</span>
		logger<span style="color:#666">.</span><span style="color:#4070a0">debug</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;Creating new JDBC DriverManager Connection to [&#34;</span> <span style="color:#666">+</span> url <span style="color:#666">+</span> <span style="color:#4070a0">&#34;]&#34;</span><span style="color:#666">);</span>
	<span style="color:#666">}</span>
  	<span style="color:#60a0b0;font-style:italic">// è°ƒäº†ä¸ªå†…éƒ¨å‡½æ•°
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">return</span> getConnectionFromDriverManager<span style="color:#666">(</span>url<span style="color:#666">,</span> props<span style="color:#666">);</span>
<span style="color:#666">}</span>

<span style="color:#007020;font-weight:bold">protected</span> Connection <span style="color:#06287e">getConnectionFromDriverManager</span><span style="color:#666">(</span>String url<span style="color:#666">,</span> Properties props<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
    <span style="color:#60a0b0;font-style:italic">// å§”æ‰˜ç»™ DriverManager ç±»æ¥è·å–è¿æ¥
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#60a0b0;font-style:italic">// DriverManager çš„ä¸»è¦æ“ä½œæ˜¯éå†åœ¨è¯¥ç®¡ç†ç±»ä¸­æ³¨å†Œçš„ Driver
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#60a0b0;font-style:italic">// æ¯ä¸ª Driver å®ä¾‹éƒ½å»å°è¯•ä¸€ä¸‹ï¼Œèƒ½ä¸èƒ½è·å¾—ä¸€ä¸ªè¿æ¥
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#60a0b0;font-style:italic">// ç¬¬ä¸€æ¬¡åœ¨æŸä¸ª Driver ä¸­æ‹¿åˆ°ä¸€ä¸ªè¿æ¥å³è¿”å›è¿æ¥ (Connection)
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">return</span> DriverManager<span style="color:#666">.</span><span style="color:#4070a0">getConnection</span><span style="color:#666">(</span>url<span style="color:#666">,</span> props<span style="color:#666">);</span>
<span style="color:#666">}</span>
</code></pre></div><p>ç®€è¦çš„ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fncrgqcjqoj31es15ajxj.jpg" alt=""></p>
<h2 id="drivermanager">DriverManager</h2>
<p>ä¸Šé¢æåˆ° DataSource è·å–è¿æ¥(Connection) çš„æ“ä½œå®è´¨ä¸Šå°†å§”æ‰˜å…·ä½“çš„ Driver æ¥æä¾› Connection ã€‚æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼ŒåŒ…æ‹¬ç»ç”± DriverManager éå†æ‰€æœ‰å¤„äºç®¡ç†ä¸‹çš„ Driver å°è¯•è·å–è¿æ¥ï¼Œæˆ–è€…åœ¨ DataSource å®ä¾‹ä¸­ç›´æ¥å£°æ˜ä¸€ä¸ªç‰¹å®šçš„ Driver æ¥è·å–è¿æ¥ã€‚</p>
<p>å¯¹äºè·å–è¿æ¥çš„å…·ä½“æ“ä½œï¼ŒæŒ–å‘-å¾…å¡«ã€‚åªæè¿°ç®€å•çš„æ•°æ®åº“ä¾›åº”å•†æä¾›çš„ Driver å¦‚ä½•ä¸ java ç›¸è”ç³»ã€‚</p>
<p>###åœ¨ DriverManager ä¸­æ³¨å†Œ Driver å®ä¾‹</p>
<p>é€šå¸¸åœ¨ä¸æ•°æ®åº“äº¤äº’é€»è¾‘çš„ Java ä»£ç ä¸­ï¼Œéƒ½ä¼šæœ‰ <code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;)</code> (æ­¤å¤„ä»¥ MySQL æä¾›çš„ mysql-connector-java-XXX.jar ä¸ºä¾‹ï¼Œä¸‹åŒï¼‰çš„ä»£ç å—ï¼ŒåŠ è½½æŒ‡å®šçš„ com.mysql.jdbc.Driver ä¸º java.lang.Class ç±»ã€‚</p>
<p><em>å½“ç„¶ï¼Œåœ¨ JDBC 4.0 æ ‡å‡†ä¸‹ï¼Œå¯ä»¥ä¸å¿…å†æ˜¾ç¤ºå£°æ˜ <code>Class.forName(&quot;&quot;)</code> è¯­å¥ï¼ŒDriver ä¹ŸåŒæ ·ä¼šåœ¨ DriverManager åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ³¨å†Œã€‚</em></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// Class ç±»ä¸­å¯¹äº forName(String className) çš„æ–¹æ³•
</span><span style="color:#60a0b0;font-style:italic">// ä½œç”¨ä¸ºè¿”å›ä¸€ä¸ª java.lang.Class å®ä¾‹ã€‚
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> Class<span style="color:#666">&lt;?&gt;</span> forName<span style="color:#666">(</span>String className<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> ClassNotFoundException <span style="color:#666">{...}</span>
</code></pre></div><p>åŒæ—¶ï¼Œ JVM åœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œç±»ä¸­çš„ static ä»£ç å—ã€‚ä¸‹è¿° row 10 ~ 16 çš„ä»£ç ç‰‡æ®µå°†è¢«æ‰§è¡Œã€‚å”¯ä¸€çš„é€»è¾‘å°±æ˜¯ new ä¸€ä¸ª com.mysql.jdbc.Driver å®ä¾‹ï¼Œå¹¶å°†å®ä¾‹æ³¨å†Œ(registerDriver) åˆ° <strong>java.sql.DriverManager</strong> ä¸­ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">package</span> <span style="color:#0e84b5;font-weight:bold">com.mysql.jdbc</span><span style="color:#666">;</span>

<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">Driver</span> <span style="color:#007020;font-weight:bold">extends</span> NonRegisteringDriver <span style="color:#007020;font-weight:bold">implements</span> java<span style="color:#666">.</span><span style="color:#4070a0">sql</span><span style="color:#666">.</span><span style="color:#4070a0">Driver</span> <span style="color:#666">{</span>
	<span style="color:#60a0b0;font-style:italic">// ~ Static fields/initializers
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// ---------------------------------------------
</span><span style="color:#60a0b0;font-style:italic"></span>
	<span style="color:#60a0b0;font-style:italic">//
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// Register ourselves with the DriverManager
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">//
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">static</span> <span style="color:#666">{</span>
		<span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
			java<span style="color:#666">.</span><span style="color:#4070a0">sql</span><span style="color:#666">.</span><span style="color:#4070a0">DriverManager</span><span style="color:#666">.</span><span style="color:#4070a0">registerDriver</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">new</span> Driver<span style="color:#666">());</span>
		<span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">catch</span> <span style="color:#666">(</span>SQLException E<span style="color:#666">)</span> <span style="color:#666">{</span>
			<span style="color:#007020;font-weight:bold">throw</span> <span style="color:#007020;font-weight:bold">new</span> RuntimeException<span style="color:#666">(</span><span style="color:#4070a0">&#34;Can&#39;t register driver!&#34;</span><span style="color:#666">);</span>
		<span style="color:#666">}</span>
	<span style="color:#666">}</span>

	<span style="color:#60a0b0;font-style:italic">// ~ Constructors
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// -----------------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic"></span>
	<span style="color:#60a0b0;font-style:italic">/**
</span><span style="color:#60a0b0;font-style:italic">	 * Construct a new driver and register it with DriverManager
</span><span style="color:#60a0b0;font-style:italic">	 * 
</span><span style="color:#60a0b0;font-style:italic">	 * @throws SQLException
</span><span style="color:#60a0b0;font-style:italic">	 *             if a database error occurs.
</span><span style="color:#60a0b0;font-style:italic">	 */</span>
	<span style="color:#007020;font-weight:bold">public</span> <span style="color:#06287e">Driver</span><span style="color:#666">()</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
		<span style="color:#60a0b0;font-style:italic">// Required for Class.forName().newInstance()
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹ DriverManager ä¸­çš„ registerDriver() æ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">DriverManager</span> <span style="color:#666">{</span>

  	<span style="color:#60a0b0;font-style:italic">// DriverManager ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Driver åˆ—è¡¨
</span><span style="color:#60a0b0;font-style:italic"></span>  	<span style="color:#60a0b0;font-style:italic">// æ­¤å¤„çš„ DriverInfo é‡Œé¢å³åŒ…è£…äº† Driver 
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">final</span> <span style="color:#007020;font-weight:bold">static</span> CopyOnWriteArrayList<span style="color:#666">&lt;</span>DriverInfo<span style="color:#666">&gt;</span> registeredDrivers <span style="color:#666">=</span> 
      	<span style="color:#007020;font-weight:bold">new</span> CopyOnWriteArrayList<span style="color:#666">&lt;&gt;();</span>

  	<span style="color:#60a0b0;font-style:italic">// åœ¨ DriverManager ä¸­æ³¨å†Œ Driver
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">synchronized</span> <span style="color:#902000">void</span> <span style="color:#06287e">registerDriver</span><span style="color:#666">(</span>java<span style="color:#666">.</span><span style="color:#4070a0">sql</span><span style="color:#666">.</span><span style="color:#4070a0">Driver</span> driver<span style="color:#666">)</span>
        <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
        registerDriver<span style="color:#666">(</span>driver<span style="color:#666">,</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">);</span>
    <span style="color:#666">}</span>
  
	<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">synchronized</span> <span style="color:#902000">void</span> <span style="color:#06287e">registerDriver</span><span style="color:#666">(</span>java<span style="color:#666">.</span><span style="color:#4070a0">sql</span><span style="color:#666">.</span><span style="color:#4070a0">Driver</span> driver<span style="color:#666">,</span>
            DriverAction da<span style="color:#666">)</span>
        <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>

      	<span style="color:#60a0b0;font-style:italic">/* å¦‚æœå½“å‰ Driver ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œå³æ·»åŠ åˆ°åˆ—è¡¨ã€‚ */</span>
        <span style="color:#007020;font-weight:bold">if</span><span style="color:#666">(</span>driver <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
            registeredDrivers<span style="color:#666">.</span><span style="color:#4070a0">addIfAbsent</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">new</span> DriverInfo<span style="color:#666">(</span>driver<span style="color:#666">,</span> da<span style="color:#666">));</span>
        <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">else</span> <span style="color:#666">{</span>
            <span style="color:#60a0b0;font-style:italic">// This is for compatibility with the original DriverManager
</span><span style="color:#60a0b0;font-style:italic"></span>            <span style="color:#007020;font-weight:bold">throw</span> <span style="color:#007020;font-weight:bold">new</span> NullPointerException<span style="color:#666">();</span>
        <span style="color:#666">}</span>

        println<span style="color:#666">(</span><span style="color:#4070a0">&#34;registerDriver: &#34;</span> <span style="color:#666">+</span> driver<span style="color:#666">);</span>

    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><h3 id="é€šè¿‡-drivermanager-è·å–è¿æ¥connection">é€šè¿‡ DriverManager è·å–è¿æ¥(Connection)</h3>
<p>ä¸Šä¸€èŠ‚æœ‰æåˆ°è¿‡å¯ä»¥é€šè¿‡ DriverManager æ¥éå†è·å–è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å£°æ˜å…·ä½“ Driver å¹¶è·å–è¿æ¥ã€‚ä¸‹é¢ä»£ç å±•ç¤ºçš„æ˜¯é€šè¿‡ DriverManager è·å–è¿æ¥çš„æ“ä½œã€‚ <del>å“ˆå“ˆå“ˆï¼Œåæ­£æœ€åéƒ½æ˜¯ç”±å…·ä½“é©±åŠ¨å®ç°è·å–è¿æ¥ã€‚</del></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">DriverManager</span> <span style="color:#666">{</span>
  	<span style="color:#60a0b0;font-style:italic">// è·å–è¿æ¥çš„ public æ¥å£ (1)
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>String url<span style="color:#666">,</span>
		java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span> info<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
		<span style="color:#007020;font-weight:bold">return</span> <span style="color:#666">(</span>getConnection<span style="color:#666">(</span>url<span style="color:#666">,</span> info<span style="color:#666">,</span> Reflection<span style="color:#666">.</span><span style="color:#4070a0">getCallerClass</span><span style="color:#666">()));</span>
	<span style="color:#666">}</span>
	<span style="color:#60a0b0;font-style:italic">// è·å–è¿æ¥çš„ public æ¥å£ (2)
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>String url<span style="color:#666">,</span>
        String user<span style="color:#666">,</span> String password<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
        java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span> info <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span><span style="color:#666">();</span>

        <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>user <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
            info<span style="color:#666">.</span><span style="color:#4070a0">put</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;user&#34;</span><span style="color:#666">,</span> user<span style="color:#666">);</span>
        <span style="color:#666">}</span>
        <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>password <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
            info<span style="color:#666">.</span><span style="color:#4070a0">put</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;password&#34;</span><span style="color:#666">,</span> password<span style="color:#666">);</span>
        <span style="color:#666">}</span>

        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#666">(</span>getConnection<span style="color:#666">(</span>url<span style="color:#666">,</span> info<span style="color:#666">,</span> Reflection<span style="color:#666">.</span><span style="color:#4070a0">getCallerClass</span><span style="color:#666">()));</span>
    <span style="color:#666">}</span>
	<span style="color:#60a0b0;font-style:italic">// è·å–è¿æ¥çš„ public æ¥å£ (3)
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>String url<span style="color:#666">)</span>
        <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
        java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span> info <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span><span style="color:#666">();</span>
        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#666">(</span>getConnection<span style="color:#666">(</span>url<span style="color:#666">,</span> info<span style="color:#666">,</span> Reflection<span style="color:#666">.</span><span style="color:#4070a0">getCallerClass</span><span style="color:#666">()));</span>
    <span style="color:#666">}</span>
 
  	<span style="color:#60a0b0;font-style:italic">// è·å–è¿æ¥çš„å†…éƒ¨é€»è¾‘å®ç°
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">static</span> Connection <span style="color:#06287e">getConnection</span><span style="color:#666">(</span>
        String url<span style="color:#666">,</span> java<span style="color:#666">.</span><span style="color:#4070a0">util</span><span style="color:#666">.</span><span style="color:#4070a0">Properties</span> info<span style="color:#666">,</span> Class<span style="color:#666">&lt;?&gt;</span> caller<span style="color:#666">)</span> 
      	<span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
        <span style="color:#60a0b0;font-style:italic">/*
</span><span style="color:#60a0b0;font-style:italic">         * When callerCl is null, we should check the application&#39;s
</span><span style="color:#60a0b0;font-style:italic">         * (which is invoking this class indirectly)
</span><span style="color:#60a0b0;font-style:italic">         * classloader, so that the JDBC driver class outside rt.jar
</span><span style="color:#60a0b0;font-style:italic">         * can be loaded from here.
</span><span style="color:#60a0b0;font-style:italic">         */</span>
        ClassLoader callerCL <span style="color:#666">=</span> caller <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span> <span style="color:#666">?</span> caller<span style="color:#666">.</span><span style="color:#4070a0">getClassLoader</span><span style="color:#666">()</span> <span style="color:#666">:</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
        <span style="color:#007020;font-weight:bold">synchronized</span><span style="color:#666">(</span>DriverManager<span style="color:#666">.</span><span style="color:#4070a0">class</span><span style="color:#666">)</span> <span style="color:#666">{</span>
            <span style="color:#60a0b0;font-style:italic">// synchronize loading of the correct classloader.
</span><span style="color:#60a0b0;font-style:italic"></span>            <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>callerCL <span style="color:#666">==</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                callerCL <span style="color:#666">=</span> Thread<span style="color:#666">.</span><span style="color:#4070a0">currentThread</span><span style="color:#666">().</span><span style="color:#4070a0">getContextClassLoader</span><span style="color:#666">();</span>
            <span style="color:#666">}</span>
        <span style="color:#666">}</span>
		<span style="color:#60a0b0;font-style:italic">// url æ˜¯å®šä½ DBMS æœ€é‡è¦çš„å‚æ•°ï¼Œä¸èƒ½ä¸ºç©º
</span><span style="color:#60a0b0;font-style:italic"></span>        <span style="color:#007020;font-weight:bold">if</span><span style="color:#666">(</span>url <span style="color:#666">==</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
            <span style="color:#007020;font-weight:bold">throw</span> <span style="color:#007020;font-weight:bold">new</span> SQLException<span style="color:#666">(</span><span style="color:#4070a0">&#34;The url cannot be null&#34;</span><span style="color:#666">,</span> <span style="color:#4070a0">&#34;08001&#34;</span><span style="color:#666">);</span>
        <span style="color:#666">}</span>

        println<span style="color:#666">(</span><span style="color:#4070a0">&#34;DriverManager.getConnection(\&#34;&#34;</span> <span style="color:#666">+</span> url <span style="color:#666">+</span> <span style="color:#4070a0">&#34;\&#34;)&#34;</span><span style="color:#666">);</span>

      	<span style="color:#60a0b0;font-style:italic">// éå†æ‰€æœ‰æ³¨å†Œçš„ Driver ï¼Œå¹¶éƒ½å°è¯•è·å–è¿æ¥(Connection)
</span><span style="color:#60a0b0;font-style:italic"></span>        SQLException reason <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>

        <span style="color:#007020;font-weight:bold">for</span><span style="color:#666">(</span>DriverInfo aDriver <span style="color:#666">:</span> registeredDrivers<span style="color:#666">)</span> <span style="color:#666">{</span>
          	<span style="color:#60a0b0;font-style:italic">// åˆ¤æ–­æ³¨å†Œçš„ Driver æ˜¯å¦ç”± ClassLoader callerCL åŠ è½½ï¼Œä¸æ˜¯åˆ™è·³è¿‡
</span><span style="color:#60a0b0;font-style:italic"></span>            <span style="color:#007020;font-weight:bold">if</span><span style="color:#666">(</span>isDriverAllowed<span style="color:#666">(</span>aDriver<span style="color:#666">.</span><span style="color:#4070a0">driver</span><span style="color:#666">,</span> callerCL<span style="color:#666">))</span> <span style="color:#666">{</span>
                <span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
                    println<span style="color:#666">(</span><span style="color:#4070a0">&#34;    trying &#34;</span> <span style="color:#666">+</span> aDriver<span style="color:#666">.</span><span style="color:#4070a0">driver</span><span style="color:#666">.</span><span style="color:#4070a0">getClass</span><span style="color:#666">().</span><span style="color:#4070a0">getName</span><span style="color:#666">());</span>
                    <span style="color:#60a0b0;font-style:italic">// è·å–è¿æ¥ï¼Œ:) è¿˜æ˜¯ç”± driver å®ä¾‹è‡ªè¡Œæä¾›
</span><span style="color:#60a0b0;font-style:italic"></span>                  	Connection con <span style="color:#666">=</span> aDriver<span style="color:#666">.</span><span style="color:#4070a0">driver</span><span style="color:#666">.</span><span style="color:#4070a0">connect</span><span style="color:#666">(</span>url<span style="color:#666">,</span> info<span style="color:#666">);</span>
                    <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>con <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                        <span style="color:#60a0b0;font-style:italic">// Success!
</span><span style="color:#60a0b0;font-style:italic"></span>                        println<span style="color:#666">(</span><span style="color:#4070a0">&#34;getConnection returning &#34;</span> <span style="color:#666">+</span> 
                                aDriver<span style="color:#666">.</span><span style="color:#4070a0">driver</span><span style="color:#666">.</span><span style="color:#4070a0">getClass</span><span style="color:#666">().</span><span style="color:#4070a0">getName</span><span style="color:#666">());</span>
                        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#666">(</span>con<span style="color:#666">);</span>
                    <span style="color:#666">}</span>
                <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">catch</span> <span style="color:#666">(</span>SQLException ex<span style="color:#666">)</span> <span style="color:#666">{</span>
                    <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>reason <span style="color:#666">==</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                        reason <span style="color:#666">=</span> ex<span style="color:#666">;</span>
                    <span style="color:#666">}</span>
                <span style="color:#666">}</span>

            <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">else</span> <span style="color:#666">{</span>
                println<span style="color:#666">(</span><span style="color:#4070a0">&#34;    skipping: &#34;</span> <span style="color:#666">+</span> aDriver<span style="color:#666">.</span><span style="color:#4070a0">getClass</span><span style="color:#666">().</span><span style="color:#4070a0">getName</span><span style="color:#666">());</span>
            <span style="color:#666">}</span>

        <span style="color:#666">}</span>

        <span style="color:#60a0b0;font-style:italic">// å¦‚æœè¿è¡Œåˆ°ä¸‹åˆ—ä»£ç ï¼Œåˆ™è¡¨æ˜è·å–è¿æ¥å¤±è´¥ï¼ŒæŠ›å‡ºé”™è¯¯
</span><span style="color:#60a0b0;font-style:italic"></span>        <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>reason <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span>    <span style="color:#666">{</span>
            println<span style="color:#666">(</span><span style="color:#4070a0">&#34;getConnection failed: &#34;</span> <span style="color:#666">+</span> reason<span style="color:#666">);</span>
            <span style="color:#007020;font-weight:bold">throw</span> reason<span style="color:#666">;</span>
        <span style="color:#666">}</span>

        println<span style="color:#666">(</span><span style="color:#4070a0">&#34;getConnection: no suitable driver found for &#34;</span><span style="color:#666">+</span> url<span style="color:#666">);</span>
        <span style="color:#007020;font-weight:bold">throw</span> <span style="color:#007020;font-weight:bold">new</span> SQLException<span style="color:#666">(</span><span style="color:#4070a0">&#34;No suitable driver found for &#34;</span><span style="color:#666">+</span> url<span style="color:#666">,</span> <span style="color:#4070a0">&#34;08001&#34;</span><span style="color:#666">);</span>
    <span style="color:#666">}</span>

<span style="color:#666">}</span>
</code></pre></div><p><em>ç®€å•çš„æä¸€å˜´ï¼ŒConnection ä»ç„¶åªæ˜¯ä¸€ä¸ªé’ˆå¯¹ Java -&gt; DB Server çš„ä¸Šå±‚æ¥å£ï¼Œå¦‚æœæƒ³è¦æ›´æ·±å±‚æ¬¡åœ°äº†è§£ Connection ä¸ DB Server çš„äº¤äº’ï¼Œå¯ä»¥å°è¯•å»çœ‹ä¸€ä¸‹ com.mysql.jdbc.MysqlIO ç±»ï¼ŒMySQL å®ç°çš„ JDBC4Connection ç±»ä¹Ÿæ˜¯åœ¨ä½¿ç”¨è¯¥ç±»æ¥å®ç°å¯¹ DB Server äº¤äº’ã€‚ï¼ˆå“ˆå“ˆï¼Œåªçœ‹è¿‡ MySQL æä¾›çš„ Driver åŒ…ï¼‰ã€‚</em></p>
<h2 id="preparedstatement--callablestatement">PreparedStatement &amp; CallableStatement</h2>
<p>åœ¨äº†è§£äº† DataSource è·å–è¿æ¥(Connection) çš„å®è´¨ä»¥åŠ JdbcTemplate çš„é€šç”¨æ¥å£ä¹‹åï¼Œä½¿ç”¨ Spring-jdbc è¿›è¡Œæ•°æ®åº“ç›¸å…³çš„æ“ä½œå¯ä»¥ç›´æˆªäº†å½“çš„åˆ©ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œå®ç°ï¼ˆæ­¤å¤„ä»…å±•ç¤ºé€šè¿‡ Java ç¡¬ç¼–ç çš„å½¢å¼è¿›è¡Œå®ç°ï¼ŒXML é…ç½®æ–¹æ³•ç±»ä¼¼ï¼‰ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#902000">void</span> <span style="color:#06287e">main</span><span style="color:#666">(</span>String<span style="color:#666">...</span> args<span style="color:#666">)</span> <span style="color:#666">{</span>
  	<span style="color:#60a0b0;font-style:italic">// å®šä¹‰æ•°æ®æº
</span><span style="color:#60a0b0;font-style:italic"></span>	DriverManagerDataSource dataSource <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> DriverManagerDataSource<span style="color:#666">();</span>
  	<span style="color:#60a0b0;font-style:italic">// é…ç½®å‚æ•°
</span><span style="color:#60a0b0;font-style:italic"></span>	dataSource<span style="color:#666">.</span><span style="color:#4070a0">setUrl</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;dbName&gt;?&lt;props&gt;&#34;</span><span style="color:#666">);</span>
   	dataSource<span style="color:#666">.</span><span style="color:#4070a0">setUsername</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;&lt;username&gt;&#34;</span><span style="color:#666">);</span>
    dataSource<span style="color:#666">.</span><span style="color:#4070a0">setPassword</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;&lt;passwd&gt;&#34;</span><span style="color:#666">);</span>
  	
  	<span style="color:#60a0b0;font-style:italic">// å®ä¾‹åŒ–ä¸€ä¸ª JDBC å·¥å…·ç±»
</span><span style="color:#60a0b0;font-style:italic"></span>  	JdbcTemplate jdbcTemplate <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> JdbcTemplate<span style="color:#666">(</span>dataSource<span style="color:#666">);</span>
  	<span style="color:#60a0b0;font-style:italic">// æ‰§è¡Œç›¸å…³ CRUD æ“ä½œ	
</span><span style="color:#60a0b0;font-style:italic"></span>  	jdbcTemplate<span style="color:#666">.</span><span style="color:#4070a0">execute</span><span style="color:#666">();</span>
<span style="color:#666">}</span>
</code></pre></div><p>å›é¡¾ç¬¬ä¸€èŠ‚æ‰€è®²çš„ JdbcTemplate çš„ 4 ä¸ªåŸºç¡€æ–¹æ³•ï¼š</p>
<ol>
<li><code>&lt;T&gt; T execute(ConnectionCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(StatementCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(PreparedStatementCreator psc, PreparedStatementCallback&lt;T&gt; action);</code></li>
<li><code>&lt;T&gt; T execute(CallableStatementCreator csc, CallableStatementCallback&lt;T&gt; action);</code></li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fndsm5tl7aj30zg0byq47.jpg" alt=""></p>
<p>å››ä¸ªåŸºç¡€æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„å›è°ƒå‡½æ•°å°†é€šè¿‡é¢„é…ç½®çš„ DataSource å¾—åˆ°çš„ Connection æˆ– æ›´è¿›ä¸€æ­¥çš„ Statement or PreparedStatement or CallableStatement ä½œä¸ºå…¥å‚æ¥æ‰§è¡Œå®šä¹‰çš„å”¯ä¸€æ–¹æ³•ã€‚</p>
<p>ä»¥ <code>&lt;T&gt; T execute(StatementCallback&lt;T&gt; action);</code> ä¸ºä¾‹æ¥äº†è§£ä¸€ä¸‹æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> T <span style="color:#06287e">execute</span><span style="color:#666">(</span>StatementCallback<span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> action<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> DataAccessException <span style="color:#666">{</span>
	<span style="color:#60a0b0;font-style:italic">// é€šè¿‡å·¥å…·ç±» DataSourceUtils è·å–ä¸€ä¸ªè¿æ¥
</span><span style="color:#60a0b0;font-style:italic"></span>  	Connection con <span style="color:#666">=</span> DataSourceUtils<span style="color:#666">.</span><span style="color:#4070a0">getConnection</span><span style="color:#666">(</span>obtainDataSource<span style="color:#666">());</span>
  	<span style="color:#60a0b0;font-style:italic">// ä¸€ä¸ª Statement ç©ºå®ä¾‹ï¼ŒPreparedStatement, CallableStatement ç±»ä¼¼
</span><span style="color:#60a0b0;font-style:italic"></span>	Statement stmt <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
	<span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
		stmt <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">createStatement</span><span style="color:#666">();</span>	<span style="color:#60a0b0;font-style:italic">// é€šè¿‡è¿æ¥(Connection)è·å–ä¸€ä¸ª Statement
</span><span style="color:#60a0b0;font-style:italic"></span>		applyStatementSettings<span style="color:#666">(</span>stmt<span style="color:#666">);</span>	<span style="color:#60a0b0;font-style:italic">// é…ç½® Statement å‚æ•°
</span><span style="color:#60a0b0;font-style:italic"></span>      	<span style="color:#60a0b0;font-style:italic">// å›è°ƒæ‰§è¡Œ doInXXX() æ–¹æ³•, å¹¶è·å¾— result
</span><span style="color:#60a0b0;font-style:italic"></span>		T result <span style="color:#666">=</span> action<span style="color:#666">.</span><span style="color:#4070a0">doInStatement</span><span style="color:#666">(</span>stmt<span style="color:#666">);</span>	
		handleWarnings<span style="color:#666">(</span>stmt<span style="color:#666">);</span>
		<span style="color:#007020;font-weight:bold">return</span> result<span style="color:#666">;</span>
    <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">catch</span><span style="color:#666">()</span> <span style="color:#666">{</span>
      
    <span style="color:#666">}</span> <span style="color:#007020;font-weight:bold">finally</span> <span style="color:#666">{</span>
      
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>ä½†æ˜¯ï¼Œå¯¹äº PreparedStatement å’Œ CallableStatement è€Œè¨€ï¼Œè·å–ä¸€ä¸ª <em>XXX</em>Statement çš„æ–¹å¼å°±æœ‰æ‰€ä¸åŒäº†ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// è·å– Statement å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic"></span>Statement stmt <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">createStatement</span><span style="color:#666">();</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// è·å– PreparedStatement å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic">// psc æ˜¯ä¸€ä¸ª PreparedStatementCreator æ¥å£å®ç°çš„å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic"></span>PreparedStatement ps <span style="color:#666">=</span> psc<span style="color:#666">.</span><span style="color:#4070a0">createPreparedStatement</span><span style="color:#666">(</span>con<span style="color:#666">);</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// è·å– CallableStatement å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic">// csc æ˜¯ä¸€ä¸ª CallableStatementCreator æ¥å£å®ç°çš„å®ä¾‹
</span><span style="color:#60a0b0;font-style:italic"></span>CallableStatement cs <span style="color:#666">=</span> csc<span style="color:#666">.</span><span style="color:#4070a0">createCallableStatement</span><span style="color:#666">(</span>con<span style="color:#666">);</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° Statement ç›´æ¥é€šè¿‡ Connection è·å–å®ä¾‹ï¼Œä½†æ˜¯ PreparedStatement å’Œ CallableStatement å°±æœ‰æ‰€ä¸åŒï¼Œå…¶åŒºåˆ«å°±åœ¨äº PreparedStatement å’Œ CallableStatement ä¸¤ä¸ª Statement éƒ½æ˜¯å¯ä»¥å®šåˆ¶å…¥å‚çš„ï¼Œæ›´ç”šè€…ï¼Œ CallableStatement å¯ä»¥å®šåˆ¶ DB æ‰§è¡Œç»“æœçš„å‡ºå‚ã€‚å½“ç„¶ï¼Œæ ¸å¿ƒè¿˜æ˜¯ <code>con.prepareStatement() OR con.prepareCall()</code> æ–¹æ³•ï¼Œåªä¸è¿‡æ˜¯å°†è·å– XXXStatement çš„æ“ä½œä¸‹æ”¾ç»™ XXXStatementCreator å®ä¾‹ç±»å®ç°ï¼Œç»™äºˆä½¿ç”¨è€…é‡å¤çš„è‡ªä¸»æƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯é€»è¾‘è§£è€¦çš„ä¸€ç§æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>SimplePreparedStatementCreator è¿™ä¸ª PreparedStatementCreator æ¥å£çš„å®ç°ç±»ï¼Œåªæ˜¯ç®€å•çš„è°ƒç”¨äº† <code>con.prepareStatement(sql)</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">SimplePreparedStatementCreator</span> 
  	<span style="color:#007020;font-weight:bold">implements</span> PreparedStatementCreator<span style="color:#666">,</span> SqlProvider <span style="color:#666">{</span>

	<span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">final</span> String sql<span style="color:#666">;</span>

	<span style="color:#555;font-weight:bold">@Override</span>
	<span style="color:#007020;font-weight:bold">public</span> PreparedStatement <span style="color:#06287e">createPreparedStatement</span><span style="color:#666">(</span>Connection con<span style="color:#666">)</span> 
      	<span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
		<span style="color:#007020;font-weight:bold">return</span> con<span style="color:#666">.</span><span style="color:#4070a0">prepareStatement</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">sql</span><span style="color:#666">);</span>
	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>è€Œå¯¹äº PreparedStatementCreatorImpl ï¼Œåœ¨ createPreparedStatement(Connection con) çš„å®ç°ä¸Šï¼Œåˆæ·»åŠ äº†æ›´å¤šçš„æ“ä½œã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">class</span> <span style="color:#0e84b5;font-weight:bold">PreparedStatementCreatorImpl</span>
		<span style="color:#007020;font-weight:bold">implements</span> PreparedStatementCreator<span style="color:#666">,</span> PreparedStatementSetter<span style="color:#666">,</span> SqlProvider<span style="color:#666">,</span> ParameterDisposer <span style="color:#666">{</span>

	<span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">final</span> String actualSql<span style="color:#666">;</span>

	<span style="color:#007020;font-weight:bold">private</span> <span style="color:#007020;font-weight:bold">final</span> List<span style="color:#666">&lt;?&gt;</span> parameters<span style="color:#666">;</span>

	<span style="color:#555;font-weight:bold">@Override</span>
	<span style="color:#007020;font-weight:bold">public</span> PreparedStatement <span style="color:#06287e">createPreparedStatement</span><span style="color:#666">(</span>Connection con<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
		PreparedStatement ps<span style="color:#666">;</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>generatedKeysColumnNames <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span> <span style="color:#666">||</span> returnGeneratedKeys<span style="color:#666">)</span> <span style="color:#666">{</span>
			<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>generatedKeysColumnNames <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>
              	<span style="color:#60a0b0;font-style:italic">// è·å–ä¸€ä¸ª PreparedStatement å®ä¾‹ï¼Œä¸‹åŒ
</span><span style="color:#60a0b0;font-style:italic"></span>				ps <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">prepareStatement</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">actualSql</span><span style="color:#666">,</span> 
                                          generatedKeysColumnNames<span style="color:#666">);</span>
			<span style="color:#666">}</span>
			<span style="color:#007020;font-weight:bold">else</span> <span style="color:#666">{</span>
				ps <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">prepareStatement</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">actualSql</span><span style="color:#666">,</span> 
                                         PreparedStatement<span style="color:#666">.</span><span style="color:#4070a0">RETURN_GENERATED_KEYS</span><span style="color:#666">);</span>
			<span style="color:#666">}</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">else</span> <span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>resultSetType <span style="color:#666">==</span> ResultSet<span style="color:#666">.</span><span style="color:#4070a0">TYPE_FORWARD_ONLY</span> 
                 <span style="color:#666">&amp;&amp;</span> <span style="color:#666">!</span>updatableResults<span style="color:#666">)</span> <span style="color:#666">{</span>
			ps <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">prepareStatement</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">actualSql</span><span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#007020;font-weight:bold">else</span> <span style="color:#666">{</span>
			ps <span style="color:#666">=</span> con<span style="color:#666">.</span><span style="color:#4070a0">prepareStatement</span><span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">actualSql</span><span style="color:#666">,</span> resultSetType<span style="color:#666">,</span>
				updatableResults <span style="color:#666">?</span> ResultSet<span style="color:#666">.</span><span style="color:#4070a0">CONCUR_UPDATABLE</span> <span style="color:#666">:</span> 
                                      ResultSet<span style="color:#666">.</span><span style="color:#4070a0">CONCUR_READ_ONLY</span><span style="color:#666">);</span>
		<span style="color:#666">}</span>
      	<span style="color:#60a0b0;font-style:italic">// å°†å¯å˜ SQL (ä¾‹å¦‚ SELECT * FROM msg WHERE id = ?) çš„ ? ç”¨å®é™…å‚æ•°æ›¿æ¢
</span><span style="color:#60a0b0;font-style:italic"></span>		setValues<span style="color:#666">(</span>ps<span style="color:#666">);</span>
		<span style="color:#007020;font-weight:bold">return</span> ps<span style="color:#666">;</span>
	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>ä»ä¸Šè¿°ä¸¤ç§ PreparedStatementCreator æ¥å£çš„ä¸åŒå®ç°ï¼Œä¹Ÿå¯ä»¥ä»å¦ä¸€ç§è§’åº¦ç†è§£åˆ°ï¼Œå‡½æ•°å¼æ¥å£å°†è·å–ç›®æ ‡å‡ºå‚çš„å…·ä½“é€»è¾‘äº¤ç»™ä½¿ç”¨è€…å®šä¹‰ï¼Œç»™äºˆäº†ä½¿ç”¨è€…å……åˆ†çš„è‡ªä¸»æƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ã€‚</p>
<p>åœ¨ä¸Šé¢ä»£ç  PreparedStatementCreatorImpl ç±»çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬ 32 è¡Œä»£ç  <code>setValue(ps)</code> ã€‚æ­¤å¤„çš„æ–¹æ³•æ˜¯ç”±æ¥å£ PreparedStatementSetter å®šä¹‰çš„ã€‚ä¸»è¦ç›®çš„æ˜¯å°†å¯å˜ SQL ä¸­çš„ ? å‚æ•°ç”¨å®é™…å‚æ•°è¿›è¡Œä¸€ä¸ªæ›¿æ¢ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">// ä»¥ SQL (SELECT * FROM msg WHERE id = ? AND day = ?) ä¸ºä¾‹
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#60a0b0;font-style:italic">/** çº¯ Java æ ¸å¿ƒåº“çš„å®ç° PreparedStatement å‚æ•°æ³¨å…¥ */</span>
ps<span style="color:#666">.</span><span style="color:#4070a0">setInt</span><span style="color:#666">(</span>1<span style="color:#666">,</span> 1763<span style="color:#666">);</span>
ps<span style="color:#666">.</span><span style="color:#4070a0">setString</span><span style="color:#666">(</span>2<span style="color:#666">,</span> <span style="color:#4070a0">&#34;2018-01-01&#34;</span><span style="color:#666">);</span>
ps<span style="color:#666">.</span><span style="color:#4070a0">executeQuery</span><span style="color:#666">();</span>

<span style="color:#60a0b0;font-style:italic">/** ä»¥ Spring-jdbc å®ç° PreparedStatement å‚æ•°æ³¨å…¥ */</span>
<span style="color:#60a0b0;font-style:italic">// setValues() ç”±æ¥å£ PreparedStatementSetter å®šä¹‰ï¼Œå°è£…äº†æ³¨å…¥å‚æ•°çš„å…·ä½“å®ç°é€»è¾‘
</span><span style="color:#60a0b0;font-style:italic">// å¯ä»¥ç”±ä½¿ç”¨è€…è‡ªè¡Œå®šä¹‰
</span><span style="color:#60a0b0;font-style:italic"></span>setValues<span style="color:#666">(</span>ps<span style="color:#666">);</span>	
ps<span style="color:#666">.</span><span style="color:#4070a0">executeQuery</span><span style="color:#666">();</span>
</code></pre></div><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fndyybh4q1j31kw0u3afx.jpg" alt=""></p>
<p>ä¸Šé¢ç±»å›¾è¡¨ç¤ºäº† PreparedStatementSetter åŠå…¶å®ç°ç±»çš„ç›¸å…³ä¾èµ–ã€‚</p>
<p>Setter çš„ä¸»è¦ç›®æ ‡å³ä¸ºå¯¹ SQL ä¸­çš„ ? å‚æ•°è¿›è¡Œæ³¨å…¥ã€‚</p>
<p><del>ä¸ªäººç²¾åŠ›æœ‰é™ï¼Œå¯¹Spring-jdbcåœ¨Statementä¸Šå¯¹å‚æ•°æ³¨å…¥çš„å›è°ƒç†è§£æœ‰é™ã€‚</del></p>
<h2 id="resultset">ResultSet</h2>
<p>åœ¨å‰å‡ èŠ‚å·²ç»æåˆ°è®²äº†æ•°æ®æºã€é©±åŠ¨ç®¡ç†å™¨ä»¥åŠ Statement ä¹‹åï¼Œåˆ©ç”¨ JDBC çš„æœ€é‡è¦çš„ç›®çš„å°±æ˜¯å¯¹ DB è¿›è¡Œæ“ä½œï¼Œå¹¶è·å¾—é¢„æœŸç»“æœã€‚å¯¹äºæŸ¥è¯¢è¯­å¥è€Œè¨€ï¼Œç»“æœåº”è¯¥æ˜¯è‹¥å¹²è®°å½•è¡Œï¼›å°±æ›´æ–°è¯­å¥è€Œè¨€ï¼Œç»“æœå¯èƒ½æ˜¯å½±å“çš„è¡Œæ•°ã€‚è€Œ Spring-jdbc å¯¹ ResultSet é¢å¤–è¿›è¡Œçš„å°è£…ï¼Œå³æ˜¯å°†åŸæœ¬æ•£ä¹±çš„ç»“æœè¿›è¡Œä¸€ä¸ªæ•´åˆï¼Œä¾‹å¦‚æ•´åˆæˆä¸€ä¸ª(ä¸€ç»„)å®Œæ•´çš„ Bean æ¥è¿›è¡Œå±•ç¤ºã€‚</p>
<p>åœ¨ JdbcTemplate ä¸­ï¼Œå››ä¸ªåŸºæœ¬æ–¹æ³•å…¥å‚éƒ½åŒ…æ‹¬ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œè€Œåœ¨æ‰§è¡Œå›è°ƒè·å¾— ResultSet ä¹‹åï¼Œæ–¹æ³•å¹¶ä¸æ˜¯ç›´æ¥è¿”å›ï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€å®šçš„æ“ä½œã€‚</p>
<p>ä»¥ä¸€ä¸ª PreparedStatementCallback çš„å®ä¾‹ç±»ä¸ºä¾‹ï¼Œåœ¨ doInPreparedStatement() æ–¹æ³•ä¸­ï¼Œè·å¾—äº† ResultSet ï¼Œä½†æ˜¯ä»é€šè¿‡ rse.extractData(rs) è¯­å¥è¿›è¡Œäº†å¤„ç†åå†è¿”å›ç»“æœ</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> T <span style="color:#06287e">doInPreparedStatement</span><span style="color:#666">(</span>PreparedStatement ps<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
  	<span style="color:#60a0b0;font-style:italic">// å£°æ˜ä¸€ä¸ª ResultSet 
</span><span style="color:#60a0b0;font-style:italic"></span>	ResultSet rs <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">;</span>
	<span style="color:#007020;font-weight:bold">try</span> <span style="color:#666">{</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>pss <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">null</span><span style="color:#666">)</span> <span style="color:#666">{</span>	<span style="color:#60a0b0;font-style:italic">// setValues() æ–¹æ³•å¡«å…… PreparedStatement ä¸­çš„å¯å˜å‚æ•° ? 
</span><span style="color:#60a0b0;font-style:italic"></span>			pss<span style="color:#666">.</span><span style="color:#4070a0">setValues</span><span style="color:#666">(</span>ps<span style="color:#666">);</span>
		<span style="color:#666">}</span>
		rs <span style="color:#666">=</span> ps<span style="color:#666">.</span><span style="color:#4070a0">executeQuery</span><span style="color:#666">();</span>	<span style="color:#60a0b0;font-style:italic">// æ‰§è¡ŒæŸ¥è¯¢ sql ï¼Œè·å–ç»“æœ
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#007020;font-weight:bold">return</span> rse<span style="color:#666">.</span><span style="color:#4070a0">extractData</span><span style="color:#666">(</span>rs<span style="color:#666">);</span>	<span style="color:#60a0b0;font-style:italic">// é‡ç‚¹... è¯¥è¯­å¥ä¸€å®šæ˜¯å¯¹ç»“æœè¿›è¡Œäº†ä¸€äº›æ“ä½œ.
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#666">}</span>
	<span style="color:#007020;font-weight:bold">finally</span> <span style="color:#666">{</span>
		JdbcUtils<span style="color:#666">.</span><span style="color:#4070a0">closeResultSet</span><span style="color:#666">(</span>rs<span style="color:#666">);</span>
		<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span>pss <span style="color:#007020;font-weight:bold">instanceof</span> ParameterDisposer<span style="color:#666">)</span> <span style="color:#666">{</span>
			<span style="color:#666">((</span>ParameterDisposer<span style="color:#666">)</span> pss<span style="color:#666">).</span><span style="color:#4070a0">cleanupParameters</span><span style="color:#666">();</span>
		<span style="color:#666">}</span>
	<span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>åœ¨æ¥çœ‹ä¸€ä¸‹ç©¶ç«Ÿåœ¨è¿”å›ç»“æœå‰è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œã€‚</p>
<p>ç”±äºæ˜¯ä¸€ä¸ªå›è°ƒæ¥å£çš„å®ç°ç±»ï¼Œrse åº”è¯¥åœ¨å¤–éƒ¨æ–¹æ³•ä¸­ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> T <span style="color:#06287e">query</span><span style="color:#666">(</span>
		PreparedStatementCreator psc<span style="color:#666">,</span> <span style="color:#555;font-weight:bold">@Nullable</span> <span style="color:#007020;font-weight:bold">final</span> PreparedStatementSetter pss<span style="color:#666">,</span> 
  		<span style="color:#007020;font-weight:bold">final</span> ResultSetExtractor<span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> rse<span style="color:#666">)</span>
		<span style="color:#007020;font-weight:bold">throws</span> DataAccessException <span style="color:#666">{</span>

	<span style="color:#007020;font-weight:bold">return</span> execute<span style="color:#666">(</span>psc<span style="color:#666">,</span> <span style="color:#007020;font-weight:bold">new</span> PreparedStatementCallback<span style="color:#666">&lt;</span>T<span style="color:#666">&gt;()</span> <span style="color:#666">{</span>
		<span style="color:#555;font-weight:bold">@Override</span>
		<span style="color:#007020;font-weight:bold">public</span> T <span style="color:#06287e">doInPreparedStatement</span><span style="color:#666">(</span>PreparedStatement ps<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
			<span style="color:#666">...</span>	
        <span style="color:#666">}</span>
	<span style="color:#666">});</span>
<span style="color:#666">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° rse æ˜¯ä¸€ä¸ª ResultSetExtractor<!-- raw HTML omitted --> çš„å®ä¾‹ã€‚ä»åç§°ä¸Šå¯ä»¥çœ‹å‡º Extractor å³ä¸ºæå–å™¨ï¼Œç»“æœé›†æå–å™¨ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#60a0b0;font-style:italic">/** å‡½æ•°å¼æ¥å£ï¼Œæä¾›çš„å”¯ä¸€æ–¹æ³•ä¸º extractData(...) */</span>
<span style="color:#555;font-weight:bold">@FunctionalInterface</span>
<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">interface</span> <span style="color:#0e84b5;font-weight:bold">ResultSetExtractor</span><span style="color:#666">&lt;</span>T<span style="color:#666">&gt;</span> <span style="color:#666">{</span>

	<span style="color:#555;font-weight:bold">@Nullable</span>
	T <span style="color:#06287e">extractData</span><span style="color:#666">(</span>ResultSet rs<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException<span style="color:#666">,</span> DataAccessException<span style="color:#666">;</span>

<span style="color:#666">}</span>
</code></pre></div><p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fndzz0pqnrj31a60i676v.jpg" alt=""></p>
<p>Spring-jdbc ä¸­ç°æœ‰çš„å®ç°æœ‰ä¸‰ä¸ªç±»ï¼Œå…¶ä¸­ RowCallbackHandlerResultSetExtractor å’Œ RowMapperResultSetExtractor ä¸¤ä¸ªç±»ä»ä¸Šé¢ç±»å›¾åŠå‘½åå³å¯çœ‹å‡ºï¼Œä¸¤ä¸ªæ˜¯ä½œä¸ºä¸€ä¸ªé€‚é…å™¨è€Œå­˜åœ¨çš„ï¼Œå°† extractData() è¿›è¡Œè½¬æ¢ï¼Œåˆ†åˆ«ç”± RowCallbackHandler å’Œ RowMapper å®ä¾‹è¿›è¡Œå…·ä½“æ“ä½œã€‚è€Œ AbstractLobStreamingResultSetExtractor ç±»ä»åç§°ä¸Šçœ‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼æµæ“ä½œçš„å®ç°ç±»(å…¶ä¸­çš„ Lob æŒ‡çš„æ˜¯ DB ä¸­çš„ BLOB ä¸ CLOB ç±»å‹ï¼Œåœ¨ Spring-jdbc ä¸­ä¹ŸåŠ å…¥äº†é¢å¤–çš„æ”¯æŒ) ã€‚</p>
<h3 id="rowcallbackhandler">RowCallbackHandler</h3>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fnh2uw3a0aj30h20jeta4.jpg" alt=""></p>
<p>ä»åç§°ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ ResultSet ç»“æœé›†è¡Œç›¸å…³çš„å›è°ƒæ¥å£ã€‚processRow(ResultSet rs) æ–¹æ³•å°†å¤„ç†è¡Œç›¸å…³çš„é€»è¾‘ã€‚</p>
<p>ä»å®ƒçš„ä¸€ä¸ªå®ç°ç±» RowCountCallbackHandler æ¥è¯´ï¼Œå…¶æœ€ä¸»è¦çš„ç§æœ‰å±æ€§ rowCount å³æ˜¯ç»Ÿè®¡ ResultSet çš„ç»“æœè¡Œæ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“ä½¿ç”¨çš„è¯¥ç±»çš„æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">static</span> <span style="color:#902000">void</span> <span style="color:#06287e">main</span><span style="color:#666">(</span>String<span style="color:#666">[]</span> args<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> ClassNotFoundException <span style="color:#666">{</span>

    DriverManagerDataSource dataSource <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> DriverManagerDataSource<span style="color:#666">();</span>
    dataSource<span style="color:#666">.</span><span style="color:#4070a0">setUrl</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;dbName&gt;&#34;</span><span style="color:#666">);</span>
    dataSource<span style="color:#666">.</span><span style="color:#4070a0">setUsername</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;&lt;username&gt;&#34;</span><span style="color:#666">);</span>
    dataSource<span style="color:#666">.</span><span style="color:#4070a0">setPassword</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;&lt;password&gt;&#34;</span><span style="color:#666">);</span>

    JdbcTemplate jdbcTemplate <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> JdbcTemplate<span style="color:#666">(</span>dataSource<span style="color:#666">);</span>
    RowCountCallbackHandler rcch <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> RowCountCallbackHandler<span style="color:#666">();</span>

    jdbcTemplate<span style="color:#666">.</span><span style="color:#4070a0">query</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;SELECT * FROM info WHERE id=&#39;2018&#39;&#34;</span><span style="color:#666">,</span> <span style="color:#666">(</span>RowCallbackHandler<span style="color:#666">)</span> rcch<span style="color:#666">);</span>
	
  	System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span>rcch<span style="color:#666">.</span><span style="color:#4070a0">getRowCount</span><span style="color:#666">());</span>	<span style="color:#60a0b0;font-style:italic">//è·å–ç»“æœé›†è¡Œæ•°
</span><span style="color:#60a0b0;font-style:italic"></span>    System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span>rcch<span style="color:#666">.</span><span style="color:#4070a0">getColumnCount</span><span style="color:#666">());</span>	<span style="color:#60a0b0;font-style:italic">// è·å–ç»“æœé›†åˆ—æ•°
</span><span style="color:#60a0b0;font-style:italic"></span>    <span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">(</span>String arg <span style="color:#666">:</span> rcch<span style="color:#666">.</span><span style="color:#4070a0">getColumnNames</span><span style="color:#666">())</span> <span style="color:#666">{</span>	<span style="color:#60a0b0;font-style:italic">// æ‰“å°ç»“æœé›†æ¯ä¸€åˆ—åç§°
</span><span style="color:#60a0b0;font-style:italic"></span>        System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;ColumnNames : &#34;</span> <span style="color:#666">+</span> arg<span style="color:#666">);</span>
    <span style="color:#666">}</span>
    <span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">(</span><span style="color:#902000">int</span> i <span style="color:#666">:</span> rcch<span style="color:#666">.</span><span style="color:#4070a0">getColumnTypes</span><span style="color:#666">())</span> <span style="color:#666">{</span>	<span style="color:#60a0b0;font-style:italic">// æ‰“å°ç»“æœé›†æ¯ä¸€åˆ—ç±»å‹(Types ä¸ºæšä¸¾ç±»)
</span><span style="color:#60a0b0;font-style:italic"></span>        System<span style="color:#666">.</span><span style="color:#4070a0">out</span><span style="color:#666">.</span><span style="color:#4070a0">println</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;ColumnTypes : &#34;</span> <span style="color:#666">+</span> i<span style="color:#666">);</span>
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>å…·ä½“æŸ¥çœ‹ RowCountCallbackHandler ç±»çš„ processRow() æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œå…¶è·å–åˆ—ç›¸å…³ä¿¡æ¯éƒ½æ¥è‡ªäº ResultSetMetaData ã€‚è€Œç»“æœè¡Œæ•°æ¥æºäº Iterator è¿­ä»£ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#555;font-weight:bold">@Override</span>
<span style="color:#007020;font-weight:bold">public</span> <span style="color:#007020;font-weight:bold">final</span> <span style="color:#902000">void</span> <span style="color:#06287e">processRow</span><span style="color:#666">(</span>ResultSet rs<span style="color:#666">)</span> <span style="color:#007020;font-weight:bold">throws</span> SQLException <span style="color:#666">{</span>
	<span style="color:#007020;font-weight:bold">if</span> <span style="color:#666">(</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">rowCount</span> <span style="color:#666">==</span> 0<span style="color:#666">)</span> <span style="color:#666">{</span>
		ResultSetMetaData rsmd <span style="color:#666">=</span> rs<span style="color:#666">.</span><span style="color:#4070a0">getMetaData</span><span style="color:#666">();</span>
		<span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnCount</span> <span style="color:#666">=</span> rsmd<span style="color:#666">.</span><span style="color:#4070a0">getColumnCount</span><span style="color:#666">();</span>
		<span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnTypes</span> <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> <span style="color:#902000">int</span><span style="color:#666">[</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnCount</span><span style="color:#666">];</span>
		<span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnNames</span> <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> String<span style="color:#666">[</span><span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnCount</span><span style="color:#666">];</span>
		<span style="color:#007020;font-weight:bold">for</span> <span style="color:#666">(</span><span style="color:#902000">int</span> i <span style="color:#666">=</span> 0<span style="color:#666">;</span> i <span style="color:#666">&lt;</span> <span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnCount</span><span style="color:#666">;</span> i<span style="color:#666">++)</span> <span style="color:#666">{</span>
			<span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnTypes</span><span style="color:#666">[</span>i<span style="color:#666">]</span> <span style="color:#666">=</span> rsmd<span style="color:#666">.</span><span style="color:#4070a0">getColumnType</span><span style="color:#666">(</span>i <span style="color:#666">+</span> 1<span style="color:#666">);</span>
			<span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">columnNames</span><span style="color:#666">[</span>i<span style="color:#666">]</span> <span style="color:#666">=</span> JdbcUtils<span style="color:#666">.</span><span style="color:#4070a0">lookupColumnName</span><span style="color:#666">(</span>rsmd<span style="color:#666">,</span> i <span style="color:#666">+</span> 1<span style="color:#666">);</span>
		<span style="color:#666">}</span>
		<span style="color:#60a0b0;font-style:italic">// could also get column names
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#666">}</span>
	processRow<span style="color:#666">(</span>rs<span style="color:#666">,</span> <span style="color:#007020;font-weight:bold">this</span><span style="color:#666">.</span><span style="color:#4070a0">rowCount</span><span style="color:#666">++);</span>
<span style="color:#666">}</span>
</code></pre></div><h3 id="rowmapper">RowMapper</h3>
<p>ä¸Šé¢ RowCallbackHandler æ¥å£ä»é€»è¾‘ä¸Šåˆ’åˆ†æ˜¯ç”¨äºå¤„ç† ResultSet å…ƒæ•°æ®ä¿¡æ¯çš„ã€‚è€Œ RowMapper è¾ƒä¸Šä¸€ä¸ªæ¥å£è€Œè¨€ï¼Œæœ‰æ›´é«˜çš„å®ç”¨æ€§ã€‚</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fnh3h739kaj30z60nago4.jpg" alt=""></p>
<p>ç‰¹åˆ«æ˜¯å…¶å®ç°ç±» BeanPropertyRowMapper<!-- raw HTML omitted --> å¯ä»¥å°†æ•£ä¹±çš„ ResultSet çš„ç»“æœæ•°æ®æ•´ç†æˆä¸€ä¸ªä¸ª Object Bean ä½œä¸ºè¿”å›ç»“æœã€‚è€Œçœå»äº†å¯¹é€ä¸€è¯»å– ResultSet è¡Œè®°å½•å¹¶å¡«å…… Bean å±æ€§çš„éº»çƒ¦ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">JdbcTemplate jdbcTemplate <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> JdbcTemplate<span style="color:#666">(</span>dataSource<span style="color:#666">);</span>

BeanPropertyRowMapper<span style="color:#666">&lt;</span>Model<span style="color:#666">&gt;</span> rowMapper <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">new</span> BeanPropertyRowMapper<span style="color:#666">&lt;&gt;(</span>Model<span style="color:#666">.</span><span style="color:#4070a0">class</span><span style="color:#666">);</span>
List<span style="color:#666">&lt;</span>Model<span style="color:#666">&gt;</span> list <span style="color:#666">=</span> jdbcTemplate<span style="color:#666">.</span><span style="color:#4070a0">query</span><span style="color:#666">(</span><span style="color:#4070a0">&#34;SELECT * FROM info WHERE id = &#39;2018&#39;&#34;</span><span style="color:#666">,</span> rowMapper<span style="color:#666">);</span>
<span style="color:#60a0b0;font-style:italic">/** è·å¾—çš„ Model list çš„å¯¹åº”å±æ€§å°†é€šè¿‡ Java çš„åå°„æœºåˆ¶è¿›è¡Œå¡«å……
</span><span style="color:#60a0b0;font-style:italic"> *	List&lt;Model&gt; list å³ç»“æœ
</span><span style="color:#60a0b0;font-style:italic"> */</span>
</code></pre></div><p>å½“ç„¶ï¼Œè¦æ±‚æ˜¯ Model ç±»ä¸­çš„å±æ€§ä¸ DB table ä¸­çš„åˆ—åä¿æŒä¸€è‡´ï¼ˆå¤§å°å†™æ— è¦æ±‚ï¼‰ã€‚</p>
<p>è€Œå…¶å®ƒä¸¤ä¸ªç±»çš„å®ç°ä¹Ÿæ˜¯åŸºäºåå°„æœºåˆ¶ï¼Œå®ç°å…¶ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">  __                    __                  
 / _| __ _ _ __   __ _ / _| ___ _ __   __ _ 
| |_ / _` | &#39;_ \ / _` | |_ / _ \ &#39;_ \ / _` |
|  _| (_| | | | | (_| |  _|  __/ | | | (_| |
|_|  \__,_|_| |_|\__, |_|  \___|_| |_|\__, |
                 |___/                |___/ 
</code></pre></div>
        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
            <div class="post-category">
              <a href="/categories/%e6%8a%80%e6%9c%af/">
                æŠ€æœ¯
              </a>
            </div>
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          



          
          
          <div style="height: 50px;"></div>
          
          <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://ffutop.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

          </div>
          
        

        <div class="site-footer">
  
</div>

      </div>
    </div>
  </article>

  

<script>
  
  
    
    
  
</script>

  

 
  </body>
</html>
