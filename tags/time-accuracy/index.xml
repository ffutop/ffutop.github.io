<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>time accuracy on Utop's Blog</title><link>https://www.ffutop.com/tags/time-accuracy/</link><description>Recent content in time accuracy on Utop's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cmn-Hans-CN</language><lastBuildDate>Fri, 26 Apr 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://www.ffutop.com/tags/time-accuracy/index.xml" rel="self" type="application/rss+xml"/><item><title>MySQL TIMESTAMP 时间精度问题</title><link>https://www.ffutop.com/posts/2019-04-26-time-accuracy/</link><pubDate>Fri, 26 Apr 2019 00:00:00 +0000</pubDate><guid>https://www.ffutop.com/posts/2019-04-26-time-accuracy/</guid><description>&lt;p>最近一段单元测试代码总是不定时地爆炸。test pass 与 failed 的比例大约 10:1 。伪代码如下:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic"> * 表结构
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic"> * CREATE TABLE `time_0` (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic"> * `timeout` timestamp NOT NULL
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic"> * )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic">// part 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic">&lt;/span>jdbcTemplate&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">execute&lt;/span>&lt;span style="color:#666">(&lt;/span>&lt;span style="color:#4070a0">&amp;#34;UPDATE `time_0` SET `timeout`=now() WHERE `id` = xxx;&amp;#34;&lt;/span>&lt;span style="color:#666">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic">// part 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#60a0b0;font-style:italic">&lt;/span>Date timeout &lt;span style="color:#666">=&lt;/span> jdbcTemplate&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">queryForObject&lt;/span>&lt;span style="color:#666">(&lt;/span>&lt;span style="color:#4070a0">&amp;#34;SELECT `timeout` FROM `time_0` WHERE `id` = xxx;&amp;#34;&lt;/span>&lt;span style="color:#666">,&lt;/span> Date&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">class&lt;/span>&lt;span style="color:#666">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Assert&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">assertTrue&lt;/span>&lt;span style="color:#666">(&lt;/span>timeout&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">getTime&lt;/span>&lt;span style="color:#666">()&lt;/span> &lt;span style="color:#666">&amp;lt;&lt;/span> System&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#4070a0">currentTimeMillis&lt;/span>&lt;span style="color:#666">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在绝大多数模拟中，先执行 &lt;code>part 1&lt;/code>，紧跟着执行 &lt;code>part 2&lt;/code> 都能通过测试。但偶尔还是挂掉了。&lt;/p></description></item></channel></rss>