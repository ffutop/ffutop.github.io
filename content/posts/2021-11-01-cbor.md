---
title: CBOR 简介
author: fangfeng
date: 2021-11-01
tags:
    - cbor
    - json
categories:
    - Cheat Sheet
---

JSON 是一种常见的数据描述格式，在 WEB 开发、NoSQL 等场景下被广泛地应用。因其人类可读形式，在数据传输与存储上开销较大。

CBOR（简明二进制对象表示）“基于” JSON ，使用极小的编解码代码程序，提供一种全新的二进制数据描述格式。

![CBOR](https://img.ffutop.com/A3E0F6D9-3EEE-458C-8C1B-34731FF932A4.png)

<!--more-->

## CBOR 数据模型

| 数据类型     | data item         | 数据范围/标准                                    |
| ------------ | ----------------- | ------------------------------------------------ |
| 整数         | integer           | $[2^{-64},2^{64}-1]$                             |
| simple value | simple value      |                                                  |
| 浮点数       | float-point value | IEEE 754 binary64                                |
| 字节数组     | byte string       | 0 或多个字节                                     |
| 字符串       | text string       | 0 或多个 Unicode 码元                            |
| 数组         | array             | 0 或多个数据类型                                 |
| 键值对       | mapping           | 0 或多个数据类型作为键，并逐一映射数据类型作为值 |
| 扩展类型     | tagged data item  | 由一个标签整型数字与标签内容组成                 |

## 目标

1. CBOR 必须能够对互联网标准中使用的最常见数据格式进行明确编码

    1.1 它必须使用二进制编码表示合理的基本数据类型集合和结构。这里的“合理”指的是对标 JSON ，但额外添加了二进制字节字符串。支持的结构仅限于数组和树；不支持循环和点阵类的图。
    1.2 不需要对所有数据格式进行唯一编码；也就是说，数字“7”可以用多种不同的方式编码是可以接受的。
    1.3 编码器或解码器的代码必须能够紧凑，以支持内存、处理器能力和指令集非常有限的系统。

2. 编解码器的代码必须足够简洁，适应有限的内存、处理器能力和指令集

    2.1 编解码器需要基于非常少量的代码实现（例如，在 [RFC7228] 中定义的 1 类约束节点限制）。
    2.2 该格式应使用数据的当代机器表示（例如，不需要二进制到十进制转换）。

3. 数据必须能够在没有模式描述的情况下被解码
    3.1 与 JSON 类似，编码数据应该是自描述的，以便可以编写通用解码器。

4. 序列化必须“合理地”紧凑，但对于编解码器而言，数据紧凑性次于代码紧凑性。

    4.1 这里的“合理”受 JSON 作为大小上限和实现复杂性的限制，这限制了实现这种紧凑性的工作量。使用通用压缩方案或广泛的位调整都违反了复杂性目标。

5. 该格式必须适用于受限节点和大容量数据

    5.1 这意味着它必须合理约束编解码时的 CPU 使用率。这对于受限节点和潜在的大容量数据应用程序都有所助益

6. 该格式必须支持所有 JSON 数据类型，以便在 JSON 之间进行转换。

    6.1 只要表示的数据在 JSON 的能力范围内，它就必须支持合理的转换级别。必须可以为所有类型的数据定义到 JSON 的单向映射。

7. 格式必须是可扩展的，并且扩展的数据必须可以被早期的解码器解码。

    7.1 该格式专为数十年的使用而设计。
    7.2 该格式必须支持一种允许回退的可扩展性形式，以便不理解扩展的解码器仍然可以对消息进行解码。
    7.3 该格式必须能够在以后的 IETF 标准中进行扩展。
    

JSON data model
CBOR is based on the wildly successful JSON data model: numbers, strings, arrays, maps (called objects in JSON), and a few values such as false, true, and null.
