---
title: GraalVM 改造实践
author: ffutop
date: 2025-06-19
categories: 
  - 案例分析
tags:
  - Java
  - GraalVM
  - JVM
---

在云原生、边缘计算场景的编程语言竞赛中，GraalVM 为 Java 重获一席之地提供了强有力的炮火支持。近期的边缘服务器场景，受限于需要快速部署、快速启动、低资源占用等要求。我们开始考虑 GraalVM ，并试验性地进行了一些工程的改造。

本篇基于改造过程中的一些实践，分享相关的内容。

## 背景介绍

原工程基于 Spring Boot 2.7.2，JDK 8。依赖 grpc 组件。负责将 grpc 调用转换成 Modbus 协议进行控制下发。

## 改造过程

### JDK 升级

GraalVM 并未提供 Java 8 版本的支持，先有 17 、21 等 LTS 版本与

### 第三方库升级

由于 GraalVM 的封闭性假设，各种第三方库并不能天然地支持 GraalVM。GraalVM 给到的说明也是希望由社区合力共建实现对 GraalVM 的兼容，而不是由 GraalVM 来适应各种第三方库。

这就意味着，大部分第三方库都需要通过升级的方式来改造，才能在 GraalVM 上运行。

| 第三方库 | 原版本 | 新版本 |
| --- | --- | --- |
| Spring Boot | 2.7.2 | 3.5.0 |
| gRPC-Spring-Boot-Starter | 2.13.1.RELEASE | 3.1.0.RELEASE |


### 修改构建流程

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <version>3.5.0</version>
            <extensions>true</extensions>
            <executions>
                <execution>
                    <goals>
                        <goal>process-aot</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
        <plugin>
            <groupId>org.graalvm.buildtools</groupId>
            <artifactId>native-maven-plugin</artifactId>
            <version>0.10.6</version>
            <extensions>true</extensions>
            <executions>
                <execution>
                    <id>build-native</id>
                    <goals>
                        <goal>compile</goal>
                    </goals>
                    <phase>package</phase>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

## 兼容性问题排除与解决

### Spring-Security 兼容性

```diff
- httpSecurity.antMatcher("/actuator/**")
+ // use securityMatcher instead
+ httpSecurity.securityMatcher("/actuator/**")
```

### gRPC 兼容性

```diff
 @Bean
 public GrpcChannelConfigurer keepAliveClientConfigurer() {
-    return (channelBuilder, name) -> {
-        if (channelBuilder instanceof NettyChannelBuilder) {
-            ((NettyChannelBuilder) channelBuilder)
-                    .defaultServiceConfig(loadServiceConfig())
-                    .keepAliveTime(30, TimeUnit.SECONDS)
-                    .keepAliveTimeout(5, TimeUnit.SECONDS);
-        }
+    return (serverBuilder, name) -> {
+        serverBuilder
+                .defaultServiceConfig(loadServiceConfig())
+                .keepAliveTime(30, TimeUnit.SECONDS)
+                .keepAliveTimeout(5, TimeUnit.SECONDS);
     };
 }
```

### Maven Plugin goal (fork or -no-fork)

