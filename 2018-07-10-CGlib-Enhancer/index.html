<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="CGlib Enhancer ä¸»æµç¨‹æºç è§£æ">




  <meta name="keywords" content="ASM, CGlib, Utop's Blog">










  <link rel="alternate" href="/atom.xml" title="Utop's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.9.0">



<link rel="canonical" href="https://DorMOUSE-None.github.io/2018-07-10-CGlib-Enhancer/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.9.0">


<link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC" rel="stylesheet">


<link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:400,700" rel="stylesheet">


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">



  


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92258941-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92258941-1');
</script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "2IQmE2X540kOtTtNPDzsNh3e-9Nh9j0Va",
      appKey: "Vk01nlYJoGnfxJ4HCPUqW7p2"
    });
  </script>




<script>
  window.config = {"title":"Utop's Blog","subtitle":null,"description":null,"author":"Utop","language":"zh-cn","timezone":"Asia/Shanghai","url":"https://DorMOUSE-None.github.io","root":"/","permalink":":title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":true,"tab_replace":null,"first_line_number":"always1"},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":10,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repo":"https://github.com/DorMOUSE-None/DorMOUSE-None.github.io.git","branch":"master","name":"DorMOUSE-None","email":"17816873960@163.com"},"ignore":[],"keywords":null,"index_generator":{"per_page":10,"order_by":"-date","path":""},"math":{"engine":"mathjax","mathjax":{"src":"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML","config":{"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}}}},"category_generator":{"per_page":10},"archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"feed":{"type":"atom","limit":20,"hub":"","content":true,"content_limit":140,"content_limit_delim":"","path":"atom.xml"},"sitemap":{"path":"sitemap.xml"},"tag_generator":{"per_page":10},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true},"server":{"port":4000,"log":false,"ip":"0.0.0.0","compress":false,"header":true},"since":2018,"favicon":"/favicon.ico","rss":"default","menu":{"Home":"/","Archives":"/archives/","Tags":"/tags","About":"/about"},"color":"Default","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":true,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"social":{"email":"dormousenone@gmail.com","stack-overflow":null,"twitter":null,"facebook":null,"linkedin":null,"google":null,"github":"https://github.com/DorMOUSE-None","weibo":null,"zhihu":null,"douban":null,"pocket":null,"tumblr":null,"instagram":null},"leancloud":{"app_id":"2IQmE2X540kOtTtNPDzsNh3e-9Nh9j0Va","app_key":"Vk01nlYJoGnfxJ4HCPUqW7p2"},"baidu_analytics":null,"baidu_verification":null,"google_analytics":"UA-92258941-1","google_verification":null,"disqus_shortname":"utop-blog","changyan":{"appid":null,"appkey":null},"livere_datauid":null,"mathjax":{"enable":true,"per_page":false,"cdn":"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"version":"2.9.0"};
</script>

    <title> CGlib Enhancer ä¸»æµç¨‹æºç è§£æ - Utop's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="mobile-header-logo">
    <a href="/." class="logo">Utop's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            æ ‡ç­¾
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            å…³äº
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Utop's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              æ ‡ç­¾
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              å…³äº
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          CGlib Enhancer ä¸»æµç¨‹æºç è§£æ
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-07-10
        </span>
        
        
        <div class="post-visits" data-url="/2018-07-10-CGlib-Enhancer/" data-title="CGlib Enhancer ä¸»æµç¨‹æºç è§£æ">
            é˜…è¯»æ¬¡æ•° 0
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enhancer"><span class="toc-text">Enhancer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enhancer-ç®€å•ç¤ºä¾‹å±•ç¤º"><span class="toc-text">Enhancer ç®€å•ç¤ºä¾‹å±•ç¤º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è°ƒç”¨é“¾è·Ÿè¸ª"><span class="toc-text">è°ƒç”¨é“¾è·Ÿè¸ª</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾"><span class="toc-text">é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-1"><span class="toc-text">Seq 1.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-2"><span class="toc-text">Seq 2.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-3"><span class="toc-text">Seq 3.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-4"><span class="toc-text">Seq 4.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-5"><span class="toc-text">Seq 5.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-6"><span class="toc-text">Seq 6.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-7"><span class="toc-text">Seq 7.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-8"><span class="toc-text">Seq 8.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-9"><span class="toc-text">Seq 9.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seq-10"><span class="toc-text">Seq 10.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ„é€ çš„å®ä¾‹"><span class="toc-text">æ„é€ çš„å®ä¾‹</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ­¤åšæ–‡å†™ä½œçš„ç›®çš„: </p>
<ul>
<li>(Core) é€šè¿‡äº†è§£ CGlib Enhancer çš„æ•´ä¸ªè°ƒç”¨é“¾ï¼Œäº†è§£å…¶å¯¹äºå”¯ä¸€ä¾èµ–çš„ ASM åº“çš„è°ƒç”¨æ–¹å¼ã€‚</li>
<li>åŸºäº Enhancer å¯¹å·²æœ‰å­—èŠ‚ç è¿›è¡Œå¢å¼ºçš„è¿›ä¸€æ­¥ç†è§£ä¸æŒæ¡ã€‚</li>
</ul>
<a id="more"></a>
<h2 id="Enhancer"><a href="#Enhancer" class="headerlink" title="Enhancer"></a>Enhancer</h2><p>ä»è¿™ç¯‡ä¸æ˜¯å®˜æ–¹ä½†æ›´èƒœäºå®˜æ–¹æ–‡æ¡£çš„ <a href="http://mydailyjava.blogspot.com/2013/11/cglib-missing-manual.html" target="_blank" rel="noopener">CGlib Guide</a> æ¥çœ‹ï¼Œå®ƒé¦–å…ˆæåˆ°çš„ç¬¬ä¸€ä¸ªç±»å°±æ˜¯ Enhancerã€‚<br>å…¶è¢«ç”¨äºåˆ›å»º Java ä»£ç†ç±»ï¼Œç›¸è¾ƒäº Java æ ‡å‡†åº“çš„ Proxy ç±»ï¼Œå®ƒ<strong>ç‰¹åˆ«åœ°</strong>ï¼Œèƒ½å¤Ÿæ”¯æŒé‚£äº›æ²¡æœ‰å®ç°æ¥å£çš„ç±»çš„ä»£ç†å·¥ä½œã€‚</p>
<h3 id="Enhancer-ç®€å•ç¤ºä¾‹å±•ç¤º"><a href="#Enhancer-ç®€å•ç¤ºä¾‹å±•ç¤º" class="headerlink" title="Enhancer ç®€å•ç¤ºä¾‹å±•ç¤º"></a>Enhancer ç®€å•ç¤ºä¾‹å±•ç¤º</h3><p>é’ˆå¯¹ç°æœ‰çš„ SampleClass ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ CGlib çš„ Enhancer å¯¹ SampleClass è¿›è¡Œå¢å¼ºï¼Œä¸‹åˆ—æ“ä½œçš„ç›®çš„åœ¨äºå°† test(String) æ–¹æ³•çš„è¿”å›å€¼æ”¹å†™æˆ â€œHello cglib!â€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFixedValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// new ä¸€ä¸ª Enhancer å®ä¾‹</span></span><br><span class="line">    Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">    <span class="comment">// å£°æ˜ä½¿ç”¨çš„çˆ¶ç±»æ˜¯ SampleClass</span></span><br><span class="line">    enhancer.setSuperclass(SampleClass.class);</span><br><span class="line">    <span class="comment">// è®¾ç½®å›è°ƒæ–¹æ³• - å›è°ƒæ–¹æ³•å®ç°ä¸º FixedValue (å›ºå®šå€¼) .</span></span><br><span class="line">    enhancer.setCallback(<span class="keyword">new</span> FixedValue() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">loadObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Hello cglib!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// åˆ›å»º SampleClass çš„ä»£ç†å­ç±»å®ä¾‹</span></span><br><span class="line">    SampleClass proxy = (SampleClass) enhancer.create();</span><br><span class="line">    Assert.assertEquals(<span class="string">"Hello cglib!"</span>, proxy.test(<span class="keyword">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æµ‹è¯•ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥äº†è§£åˆ°ç¡®å®ï¼Œä»£ç†ç±»çš„ test(String) æ–¹æ³•çš„è¿”å›å€¼è¢«æ”¹å†™äº†ã€‚<br>é‚£ä¹ˆï¼Œç©¶ç«Ÿè¿™ç§æ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿä¸‹é¢ğŸ‘‡å°†è¿›è¡Œå…·ä½“çš„æ¢ç©¶ã€‚</p>
<h2 id="è°ƒç”¨é“¾è·Ÿè¸ª"><a href="#è°ƒç”¨é“¾è·Ÿè¸ª" class="headerlink" title="è°ƒç”¨é“¾è·Ÿè¸ª"></a>è°ƒç”¨é“¾è·Ÿè¸ª</h2><h3 id="é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾"><a href="#é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾" class="headerlink" title="é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾"></a>é«˜åº¦æŠ½è±¡çš„æ—¶åºå›¾</h3><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ft4ifuo997j31jh0st42t.jpg" alt="Enhancer è°ƒç”¨é“¾ æ—¶åºå›¾"></p>
<p><em>ä¸‹åˆ—å†…å®¹å°†æ ¹æ®æ—¶åºå›¾è¿›è¡Œç»„ç»‡ï¼Œæ ¹æ®è°ƒç”¨ç¼–å·(1,2,3â€¦)è¿›è¡Œå±•å¼€</em></p>
<h3 id="Seq-1"><a href="#Seq-1" class="headerlink" title="Seq 1."></a>Seq 1.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    classOnly = <span class="keyword">false</span>;</span><br><span class="line">    argumentTypes = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> createHelper();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class[] argumentTypes, Object[] arguments)</span> </span>&#123;</span><br><span class="line">    classOnly = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (argumentTypes == <span class="keyword">null</span> || arguments == <span class="keyword">null</span> || argumentTypes.length != arguments.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Arguments must be non-null and of equal length"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.argumentTypes = argumentTypes;</span><br><span class="line">    <span class="keyword">this</span>.arguments = arguments;</span><br><span class="line">    <span class="keyword">return</span> createHelper();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¸¤ä¸ª <code>create(...)</code> æ–¹æ³•ã€‚ç»“åˆä¸Šä¸€èŠ‚çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ° <code>create()</code> å¯¹åº”çš„<strong>æ— å‚æ„é€ </strong>ã€‚<br>å­˜åœ¨æ— å‚æ„é€ ï¼Œé‚£ä¹ˆ<strong>æœ‰å‚çš„æ„é€ æ–¹æ³•</strong>æ˜¾ç„¶ä¹Ÿæ˜¯åº”è¯¥è¢«æ”¯æŒidã€‚<code>create(Class[], Object[])</code> æ­£æ˜¯ä¸ºäº†è¿™ä¸ªç›®æ ‡è€Œå­˜åœ¨ã€‚é€šè¿‡æä¾›å‚æ•°ç±»å‹æ•°ç»„å’Œå‚æ•°å®ä¾‹æ•°ç»„ï¼Œå¯ä»¥å”¯ä¸€åœ°å®šä½åŠè°ƒç”¨ä»£ç†ç±»çš„ç‰¹å®šæ„é€ æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å°† Enhancer ä½œä¸ºä¸€ä¸ªæ•°æ®å†…å®¹çš„æŒæœ‰è€…ï¼Œé‡ç½®äº†æ–°ä»£ç†ç±»å°†ä½¿ç”¨çš„æ„é€ å‡½æ•°å‚æ•°å†…å®¹ï¼Œä¹‹åå°±ç›´æ¥è°ƒç”¨äº† <code>createHelper()</code> ã€‚</p>
<h3 id="Seq-2"><a href="#Seq-2" class="headerlink" title="Seq 2."></a>Seq 2.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">createHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹é¢„å£°æ˜çš„å›è°ƒæ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œè¦æ±‚ [å¤šä¸ªå›è°ƒå°±å¿…é¡»å­˜åœ¨ CallbackFilter ä½œä¸ºè°ƒåº¦å™¨]</span></span><br><span class="line">    preValidate();</span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ªå¯¹è¿™ç±»å¢å¼ºæ“ä½œå”¯ä¸€å®šä½çš„ key</span></span><br><span class="line">    Object key = KEY_FACTORY.newInstance((superclass != <span class="keyword">null</span>) ? superclass.getName() : <span class="keyword">null</span>,</span><br><span class="line">            ReflectUtils.getNames(interfaces),</span><br><span class="line">            filter == ALL_ZERO ? <span class="keyword">null</span> : <span class="keyword">new</span> WeakCacheKey&lt;CallbackFilter&gt;(filter),</span><br><span class="line">            callbackTypes,</span><br><span class="line">            useFactory,</span><br><span class="line">            interceptDuringConstruction,</span><br><span class="line">            serialVersionUID);</span><br><span class="line">    <span class="keyword">this</span>.currentKey = key;</span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»é€šè¿‡çš„ create(...) æ–¹æ³•</span></span><br><span class="line">    Object result = <span class="keyword">super</span>.create(key);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Seq-3"><a href="#Seq-3" class="headerlink" title="Seq 3."></a>Seq 3.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">create</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨äº åŠ è½½ ç”Ÿæˆç±» çš„ ClassLoader</span></span><br><span class="line">        ClassLoader loader = getClassLoader();</span><br><span class="line">        <span class="comment">// ä»ç¼“å­˜ä¸­åŠ è½½ è¿™ä¸ª ClassLoader è¿‡å»åŠ è½½çš„ç›¸å…³æ•°æ®</span></span><br><span class="line">        Map&lt;ClassLoader, ClassLoaderData&gt; cache = CACHE;</span><br><span class="line">        ClassLoaderData data = cache.get(loader);</span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨ ç¼“å­˜ ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™åˆå§‹åŒ–æ„é€ å…³äºè¿™ä¸ª ClassLoader çš„æ•°æ®å®ä¾‹</span></span><br><span class="line">        <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åŒæ­¥</span></span><br><span class="line">            <span class="keyword">synchronized</span> (AbstractClassGenerator.class) &#123;</span><br><span class="line">                <span class="comment">// è¿›å…¥åŒæ­¥å—åçš„ å†æ¬¡ç¡®è®¤ï¼Œé¿å…é‡å¤åˆå§‹åŒ–æ„å»º</span></span><br><span class="line">                cache = CACHE;</span><br><span class="line">                data = cache.get(loader);</span><br><span class="line">                <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ„å»ºæ–°çš„ ç¼“å­˜ï¼Œæ‹·è´åŸæœ‰çš„ç¼“å­˜é›†çš„å†…å®¹</span></span><br><span class="line">                    Map&lt;ClassLoader, ClassLoaderData&gt; newCache = <span class="keyword">new</span> WeakHashMap&lt;ClassLoader, ClassLoaderData&gt;(cache);</span><br><span class="line">                    <span class="comment">// åˆå§‹åŒ– ClassLoaderData ï¼ŒçœŸæ­£çš„æ„é€ æ“ä½œ</span></span><br><span class="line">                    data = <span class="keyword">new</span> ClassLoaderData(loader);</span><br><span class="line">                    <span class="comment">// æ·»åŠ åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">                    newCache.put(loader, data);</span><br><span class="line">                    CACHE = newCache;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        Object obj = data.get(<span class="keyword">this</span>, getUseCache());</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Class) &#123;</span><br><span class="line">            <span class="comment">// åˆæ¬¡å®ä¾‹åŒ–æ“ä½œï¼Œå°±æ˜¯ Class åˆ©ç”¨åå°„æ¥è¿›è¡Œå®ä¾‹åŒ–</span></span><br><span class="line">            <span class="keyword">return</span> firstInstance((Class) obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éåˆæ¬¡å®ä¾‹åŒ–ï¼Œåˆ™æ˜¯ä» ClassLoaderData ä¸­å¾—åˆ°çš„ä¹‹å‰ç»´æŠ¤çš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">return</span> nextInstance(obj);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Error e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CodeGenerationException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤šï¼Œä¸”æ˜¯è°ƒç”¨é“¾æ¯”è¾ƒé‡è¦çš„ä¸€ç¯ã€‚<strong>Seq 4.</strong> å’Œ <strong>Seq 5.</strong> å°†ä½œä¸ºå…¶å­å†…å®¹è¿›è¡Œè°ƒç”¨ï¼Œä½†ä¸ºäº†æœ¬åšæ–‡çš„ç»“æ„å®Œæ•´ï¼Œ <em>Seq 4. &amp; Seq5.</em> çš„æ ‡é¢˜ä¸ <em>Seq 3.</em> æ ‡é¢˜åŒçº§</p>
<h3 id="Seq-4"><a href="#Seq-4" class="headerlink" title="Seq 4."></a>Seq 4.</h3><p>é¦–å…ˆåº”è¯¥è®¤è¯†åˆ°ï¼Œæ¯ä¸ªè¢«åŠ è½½çš„ Class ï¼Œåœ¨ <code>equal</code> çš„åˆ¤æ–­è¿‡ç¨‹ä¸­ï¼Œä¾æ®çš„æ˜¯åŒä¸€ä¸ª ClassLoader åŠ è½½çš„åŒä¸€ Class æ‰è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„ï¼Œå¦åˆ™å³ä½¿ Class æ˜¯åŒä¸€ä¸ªï¼Œä½†ä»ä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„(ç”±ä¸åŒçš„ ClassLoader åŠ è½½)ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ClassLoader t = classLoader;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">        t = getDefaultClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">        t = getClass().getClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">        t = Thread.currentThread().getContextClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot determine classloader"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œåœ¨è¿™éƒ¨åˆ†ä¸­ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šçš„æ˜¯ç”±å“ªä¸ª ClassLoader è¿›è¡ŒåŠ è½½çš„å·¥ä½œã€‚<code>getClassLoader()</code> çš„ç¡®å®šé¡ºåºæ˜¯:</p>
<ol>
<li>å…·ä½“å®ç°ç±»å£°æ˜çš„ <strong>é»˜è®¤ ClassLoader</strong> ä¸ºç¬¬ä¸€ä¼˜å…ˆçº§</li>
<li>åŠ è½½å½“å‰ç±»(è¿™é‡Œæ˜¯ Enhancer) çš„ ClassLoader ä¸ºç¬¬äºŒä¼˜å…ˆçº§</li>
<li><strong>å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ ClassLoader</strong> ä¸ºç¬¬ä¸‰ä¼˜å…ˆçº§</li>
<li>æŠ›å‡ºå¼‚å¸¸</li>
</ol>
<p>å›åˆ° <strong>Seq 3.</strong> çš„å†…å®¹ï¼Œ<br>ä¸‹ä¸€æ­¥æ˜¯å¯¹å½“å‰è¿™ä¸ª<strong>AbstractClassGenerator</strong> ç»´æŠ¤çš„ CACHE è¿›è¡Œå¤„ç†ï¼Œå¦‚æœåœ¨ CACHE ä¸­èƒ½å¤Ÿå¾—åˆ°ä»¥ç¡®å®šçš„ ClassLoader ä¸º Key çš„é”®å€¼å¯¹ï¼Œåˆ™ç›´æ¥è·å– ClassLoader å¯¹åº”çš„å€¼ï¼Œå¦åˆ™å°†è¿›è¡Œåˆå§‹åŒ–æ„å»ºä¸€ä¸ªæ–°çš„ ClassLoaderData ä½œä¸ºè¿™ä¸ª ClassLoader çš„å€¼ã€‚</p>
<h3 id="Seq-5"><a href="#Seq-5" class="headerlink" title="Seq 5."></a>Seq 5.</h3><p>åœ¨æ„å»º ClassLoaderData çš„è¿‡ç¨‹ä¸­ï¼Œæœ€é‡è¦çš„ä¸€æ­¥:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassLoaderData</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ClassLoader ä¸å¯ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"classLoader == null is not yet supported"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ„å»º ClassLoader çš„å¼±å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.classLoader = <span class="keyword">new</span> WeakReference&lt;ClassLoader&gt;(classLoader);</span><br><span class="line">    <span class="comment">// å†™äº†ä¸ªåç½®è°ƒç”¨çš„å‡½æ•°ï¼Œç”¨äºæ‡’åŠ è½½ï¼Œåªæœ‰è°ƒç”¨äº† load.apply(...) æ‰ä¼šæ„å»º ç”Ÿæˆç±»</span></span><br><span class="line">    Function&lt;AbstractClassGenerator, Object&gt; load =</span><br><span class="line">            <span class="keyword">new</span> Function&lt;AbstractClassGenerator, Object&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(AbstractClassGenerator gen)</span> </span>&#123;</span><br><span class="line">                    Class klass = gen.generate(ClassLoaderData.<span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">return</span> gen.wrapCachedClass(klass);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">    generatedClasses = <span class="keyword">new</span> LoadingCache&lt;AbstractClassGenerator, Object, Object&gt;(GET_KEY, load);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„å»ºäº†ä¸€ä¸ª Function å®ä¾‹ï¼Œè¿™ä¸ª Function ä½œä¸ºå‡½æ•°å¼æ¥å£ï¼Œé¢„å®šä¹‰æ‰§è¡Œçš„å…·ä½“æµç¨‹ï¼Œä½†ç”±ä¸Šä¸‹æ–‡ç¡®å®šå…·ä½“çš„è°ƒç”¨æ—¶åˆ»ã€‚</p>
<h3 id="Seq-6"><a href="#Seq-6" class="headerlink" title="Seq 6."></a>Seq 6.</h3><p>åœ¨æ­£ç¡®å¾—åˆ°äº† ClassLoader å¯¹åº”çš„ ClassLoaderData ä¹‹åï¼ŒClassLoaderData çš„ <code>get(...)</code> æ–¹æ³•å°†åœ¨ç‰¹å®šçš„ ClassLoader ä¹‹ä¸‹ï¼Œè¿›è¡Œæ›´å…·ä½“çš„åŠ è½½æ–°ç”Ÿæˆç±»çš„å·¥ä½œã€‚<br>å½“ç„¶ï¼Œè¿™é‡Œçš„å‰ææ˜¯æ–°çš„ç”Ÿæˆç±»çš„å­—èŠ‚ç å·²ç»è¢«æ„å»º:)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(AbstractClassGenerator gen, <span class="keyword">boolean</span> useCache)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ ‡è®°ä¸ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œç›´æ¥æ„å»º æ–°çš„ç”Ÿæˆç±»</span></span><br><span class="line">    <span class="keyword">if</span> (!useCache) &#123;</span><br><span class="line">      <span class="keyword">return</span> gen.generate(ClassLoaderData.<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¼“å†²çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      Object cachedValue = generatedClasses.get(gen);</span><br><span class="line">      <span class="keyword">return</span> gen.unwrapCachedValue(cachedValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° <code>gen.generate(ClassLoaderData.this)</code> è¿™æ®µä»£ç åœ¨ <code>get(...)</code> æ–¹æ³•å’Œä¸Šä¸€å°èŠ‚ <code>ClassLoaderData(...)</code> æ„é€ æ–¹æ³•çš„ Function å‡½æ•°å¼å®ä¾‹éƒ½å‡ºç°äº†ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™ä¹Ÿæ˜¯è§¦å‘ ClassLoader æ¥åŠ è½½åŠ¨æ€ç”Ÿæˆçš„æ–° Class çš„å”¯ä¸€å…¥å£ã€‚</p>
<p><em>åˆ¤æ–­é€»è¾‘</em> çš„ <code>else</code> å†…å®¹çš„å”¯ä¸€åŒºåˆ«å°±åœ¨äºå…¶æ„å»ºçš„æ˜¯ä¸€ä¸ªåŠ è½½ç¼“å­˜ï¼Œå°†çœŸæ­£è§¦å‘ gen.generate(ClassLoaderData.this) çš„é€»è¾‘å»¶è¿Ÿã€‚(ä¸è¿‡ï¼Œæœ€ç»ˆä¹Ÿè¿˜æ˜¯ä¼šè¿›è¡Œè°ƒç”¨çš„ï¼Œ:) è¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„)ã€‚</p>
<h3 id="Seq-7"><a href="#Seq-7" class="headerlink" title="Seq 7."></a>Seq 7.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Class <span class="title">generate</span><span class="params">(ClassLoaderData data)</span> </span>&#123;</span><br><span class="line">    Class gen;</span><br><span class="line">    Object save = CURRENT.get();</span><br><span class="line">    CURRENT.set(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°ç”¨äºåŠ è½½ç”Ÿæˆç±»çš„ ClassLoader</span></span><br><span class="line">        ClassLoader classLoader = data.getClassLoader();</span><br><span class="line">        <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"ClassLoader is null while trying to define class "</span> +</span><br><span class="line">                    getClassName() + <span class="string">". It seems that the loader has been expired from a weak reference somehow. "</span> +</span><br><span class="line">                    <span class="string">"Please file an issue at cglib's issue tracker."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ„å»ºä¸€ä¸ªåˆæ³•çš„ ç”Ÿæˆç±» çš„ç±»å(éé‡å¤)</span></span><br><span class="line">        <span class="keyword">synchronized</span> (classLoader) &#123;</span><br><span class="line">          String name = generateClassName(data.getUniqueNamePredicate());</span><br><span class="line">          data.reserveName(name);</span><br><span class="line">          <span class="keyword">this</span>.setClassName(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (attemptLoad) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å°è¯•ç›´æ¥é€šè¿‡ ClassLoader è¿›è¡ŒåŠ è½½</span></span><br><span class="line">                gen = classLoader.loadClass(getClassName());</span><br><span class="line">                <span class="keyword">return</span> gen;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç­–ç•¥ä¸‹çš„ç”Ÿæˆç±»æ„å»ºæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">byte</span>[] b = strategy.generate(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡è§£æå­—èŠ‚ç çš„å½¢å¼è·å– ç”Ÿæˆç±»çš„ className</span></span><br><span class="line">        String className = ClassNameReader.getClassName(<span class="keyword">new</span> ClassReader(b));</span><br><span class="line">        ProtectionDomain protectionDomain = getProtectionDomain();</span><br><span class="line">        <span class="keyword">synchronized</span> (classLoader) &#123; <span class="comment">// just in case</span></span><br><span class="line">            <span class="comment">// åå°„çš„å½¢å¼åŠ è½½ Class ç±»</span></span><br><span class="line">            <span class="keyword">if</span> (protectionDomain == <span class="keyword">null</span>) &#123;</span><br><span class="line">                gen = ReflectUtils.defineClass(className, b, classLoader);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                gen = ReflectUtils.defineClass(className, b, classLoader, protectionDomain);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> gen;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Error e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CodeGenerationException(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        CURRENT.set(save);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯æ“ä½œå­—èŠ‚ç ï¼ŒåŠ è½½ Class çš„æ ¸å¿ƒè°ƒåº¦æ–¹æ³•ã€‚</p>
<p>å¯ä»¥çœ‹åˆ° <code>generateClassName(...)</code> æ–¹æ³•å°†æ„å»ºä¸€ä¸ªå½“å‰ ClassLoader ä¸‹å”¯ä¸€, ä¸é‡å¤çš„æ–°çš„ç±»åã€‚</p>
<p><code>strategy.generate(this)</code> å°†é€šè¿‡ç‰¹å®šç­–ç•¥å®ç°çš„å½¢å¼ç”Ÿæˆæ–°çš„å­—èŠ‚ç </p>
<p><code>ReflectUtils.defineClass(className, b, classLoader)</code> å°†ä½¿ç”¨åå°„ä½¿å¾— ClassLoader æ¥åŠ è½½è¿™ä¸ªæ–°çš„ç”Ÿæˆç±»ã€‚</p>
<h3 id="Seq-8"><a href="#Seq-8" class="headerlink" title="Seq 8."></a>Seq 8.</h3><p>ç”Ÿæˆæ–°çš„ä¸é‡å¤ç±»åè¿™éƒ¨åˆ†ä¸åšè¿‡å¤šé™ˆè¿°ï¼Œå¯ä»¥ç®€å•è¿›è¡Œäº†è§£ï¼Œå¹¶ç†Ÿæ‚‰ CGlib é»˜è®¤çš„æ–°ç±»åçš„å‘½åè§„åˆ™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultNamePolicy</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getClassName</span><span class="params">(String prefix, String source, Object key, Predicate names)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (prefix == <span class="keyword">null</span>) &#123;</span><br><span class="line">        prefix = <span class="string">"net.sf.cglib.empty.Object"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prefix.startsWith(<span class="string">"java"</span>)) &#123;</span><br><span class="line">        prefix = <span class="string">"$"</span> + prefix;</span><br><span class="line">    &#125;</span><br><span class="line">    String base =</span><br><span class="line">        prefix + <span class="string">"$$"</span> +</span><br><span class="line">        source.substring(source.lastIndexOf(<span class="string">'.'</span>) + <span class="number">1</span>) +</span><br><span class="line">        getTag() + <span class="string">"$$"</span> +</span><br><span class="line">        Integer.toHexString(STRESS_HASH_CODE ? <span class="number">0</span> : key.hashCode());</span><br><span class="line">    String attempt = base;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">while</span> (names.evaluate(attempt))</span><br><span class="line">        attempt = base + <span class="string">"_"</span> + index++;</span><br><span class="line">    <span class="keyword">return</span> attempt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Seq-9"><a href="#Seq-9" class="headerlink" title="Seq 9."></a>Seq 9.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹åˆ—æ˜¯ DefaultGeneratorStrategy çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] generate(ClassGenerator cg) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    DebuggingClassWriter cw = getClassVisitor();</span><br><span class="line">    transform(cg).generateClass(cw);</span><br><span class="line">    <span class="keyword">return</span> transform(cw.toByteArray());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Seq-10"><a href="#Seq-10" class="headerlink" title="Seq 10."></a>Seq 10.</h3><p>è°ƒç”¨ <code>generateClass(ClassVisitor)</code> å°†è·å¾—åˆ°æ–°ç±»çš„å­—èŠ‚ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateClass</span><span class="params">(ClassVisitor v)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// ç¡®å®šç”Ÿæˆç±»çš„ çˆ¶ç±»</span></span><br><span class="line">    Class sc = (superclass == <span class="keyword">null</span>) ? Object.class : superclass;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çˆ¶ç±»æ ‡è¯†ç¬¦ä¸å¯ä»¥ä¸º final</span></span><br><span class="line">    <span class="keyword">if</span> (TypeUtils.isFinal(sc.getModifiers()))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Cannot subclass final class "</span> + sc.getName());</span><br><span class="line">    <span class="comment">// è·å–çˆ¶ç±»ç›´æ¥å£°æ˜çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">    List constructors = <span class="keyword">new</span> ArrayList(Arrays.asList(sc.getDeclaredConstructors()));</span><br><span class="line">    filterConstructors(sc, constructors);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Order is very important: must add superclass, then</span></span><br><span class="line">    <span class="comment">// its superclass chain, then each interface and</span></span><br><span class="line">    <span class="comment">// its superinterfaces.</span></span><br><span class="line">    List actualMethods = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    List interfaceMethods = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">final</span> Set forcePublic = <span class="keyword">new</span> HashSet();</span><br><span class="line">    <span class="comment">// ä»çˆ¶ç±»ä¸­æå–å„ç§ä¿¡æ¯</span></span><br><span class="line">    getMethods(sc, interfaces, actualMethods, interfaceMethods, forcePublic);</span><br><span class="line"></span><br><span class="line">    List methods = CollectionUtils.transform(actualMethods, <span class="keyword">new</span> Transformer() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object value)</span> </span>&#123;</span><br><span class="line">            Method method = (Method)value;</span><br><span class="line">            <span class="keyword">int</span> modifiers = Constants.ACC_FINAL</span><br><span class="line">                | (method.getModifiers()</span><br><span class="line">                   &amp; ~Constants.ACC_ABSTRACT</span><br><span class="line">                   &amp; ~Constants.ACC_NATIVE</span><br><span class="line">                   &amp; ~Constants.ACC_SYNCHRONIZED);</span><br><span class="line">            <span class="keyword">if</span> (forcePublic.contains(MethodWrapper.create(method))) &#123;</span><br><span class="line">                modifiers = (modifiers &amp; ~Constants.ACC_PROTECTED) | Constants.ACC_PUBLIC;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ReflectUtils.getMethodInfo(method, modifiers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ClassEmitter e = <span class="keyword">new</span> ClassEmitter(v);</span><br><span class="line">    <span class="keyword">if</span> (currentData == <span class="keyword">null</span>) &#123;</span><br><span class="line">    e.begin_class(Constants.V1_2,</span><br><span class="line">                  Constants.ACC_PUBLIC,</span><br><span class="line">                  getClassName(),</span><br><span class="line">                  Type.getType(sc),</span><br><span class="line">                  (useFactory ?</span><br><span class="line">                   TypeUtils.add(TypeUtils.getTypes(interfaces), FACTORY) :</span><br><span class="line">                   TypeUtils.getTypes(interfaces)),</span><br><span class="line">                  Constants.SOURCE_FILE);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        e.begin_class(Constants.V1_2,</span><br><span class="line">                Constants.ACC_PUBLIC,</span><br><span class="line">                getClassName(),</span><br><span class="line">                <span class="keyword">null</span>,</span><br><span class="line">                <span class="keyword">new</span> Type[]&#123;FACTORY&#125;,</span><br><span class="line">                Constants.SOURCE_FILE);</span><br><span class="line">    &#125;</span><br><span class="line">    List constructorInfo = CollectionUtils.transform(constructors, MethodInfoTransformer.getInstance());</span><br><span class="line"></span><br><span class="line">    e.declare_field(Constants.ACC_PRIVATE, BOUND_FIELD, Type.BOOLEAN_TYPE, <span class="keyword">null</span>);</span><br><span class="line">    e.declare_field(Constants.ACC_PUBLIC | Constants.ACC_STATIC, FACTORY_DATA_FIELD, OBJECT_TYPE, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (!interceptDuringConstruction) &#123;</span><br><span class="line">        e.declare_field(Constants.ACC_PRIVATE, CONSTRUCTED_FIELD, Type.BOOLEAN_TYPE, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    e.declare_field(Constants.PRIVATE_FINAL_STATIC, THREAD_CALLBACKS_FIELD, THREAD_LOCAL, <span class="keyword">null</span>);</span><br><span class="line">    e.declare_field(Constants.PRIVATE_FINAL_STATIC, STATIC_CALLBACKS_FIELD, CALLBACK_ARRAY, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (serialVersionUID != <span class="keyword">null</span>) &#123;</span><br><span class="line">        e.declare_field(Constants.PRIVATE_FINAL_STATIC, Constants.SUID_FIELD_NAME, Type.LONG_TYPE, serialVersionUID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; callbackTypes.length; i++) &#123;</span><br><span class="line">        e.declare_field(Constants.ACC_PRIVATE, getCallbackField(i), callbackTypes[i], <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// This is declared private to avoid "public field" pollution</span></span><br><span class="line">    e.declare_field(Constants.ACC_PRIVATE | Constants.ACC_STATIC, CALLBACK_FILTER_FIELD, OBJECT_TYPE, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentData == <span class="keyword">null</span>) &#123;</span><br><span class="line">        emitMethods(e, methods, actualMethods);</span><br><span class="line">        emitConstructors(e, constructorInfo);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        emitDefaultConstructor(e);</span><br><span class="line">    &#125;</span><br><span class="line">    emitSetThreadCallbacks(e);</span><br><span class="line">    emitSetStaticCallbacks(e);</span><br><span class="line">    emitBindCallbacks(e);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (useFactory || currentData != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] keys = getCallbackKeys();</span><br><span class="line">        emitNewInstanceCallbacks(e);</span><br><span class="line">        emitNewInstanceCallback(e);</span><br><span class="line">        emitNewInstanceMultiarg(e, constructorInfo);</span><br><span class="line">        emitGetCallback(e, keys);</span><br><span class="line">        emitSetCallback(e, keys);</span><br><span class="line">        emitGetCallbacks(e);</span><br><span class="line">        emitSetCallbacks(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    e.end_class();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>generateClass(...)</code> æ‰§è¡Œçš„æ“ä½œå’Œ ASM åº“çš„ ClassVisitor è®¿é—® Class æ–‡ä»¶ç»“æ„çš„æµç¨‹åŸºæœ¬ç±»ä¼¼ã€‚</p>
<p>ä»ä¸Šè¿°æˆªå–åˆ°çš„éƒ¨åˆ†ä»£ç ï¼Œä¾‹å¦‚:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.begin_class(Constants.V1_2, Constants.ACC_PUBLIC, getClassName(), Type.getType(sc), </span><br><span class="line">        (useFactory ? TypeUtils.add(TypeUtils.getTypes(interfaces), FACTORY) : TypeUtils.getTypes(interfaces)),</span><br><span class="line">        Constants.SOURCE_FILE);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e.declare_field(Constants.PRIVATE_FINAL_STATIC, THREAD_CALLBACKS_FIELD, THREAD_LOCAL, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<p>éƒ½ä¸ <code>classVisitor.visit(...)</code> ä»¥åŠ <code>classVisitor.visitField(...)</code> ç›¸å½“ç±»ä¼¼ã€‚è€Œäº‹å®ä¸Šï¼Œè¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°ä¹Ÿç¡®å®è°ƒç”¨äº† cv.visitXxx(â€¦) ã€‚<br>æ¯•ç«Ÿï¼Œä½œä¸º CGlib å”¯ä¸€ä¾èµ–çš„åº“ï¼ŒASM è¿˜æ˜¯å¯ä»¥è¯´æ˜¯éš¾ä»¥æ›¿ä»£çš„(æ—¢ç„¶å·²ç»æœ‰äº†å¯ç”¨çš„è½®å­ï¼Œåˆä½•å¿…é‡å¤é€ å‘¢?)</p>
<h2 id="æ„é€ çš„å®ä¾‹"><a href="#æ„é€ çš„å®ä¾‹" class="headerlink" title="æ„é€ çš„å®ä¾‹"></a>æ„é€ çš„å®ä¾‹</h2><p>ä¸‹é¢å°†å±•ç¤ºé€šè¿‡ CGlib ç”Ÿæˆçš„æ–°çš„ç±»(ç”±äºç”Ÿæˆçš„æ˜¯å­—èŠ‚ç ï¼Œæ‡’å¾—å†è‡ªè¡Œè§£æ ClassFile çš„å†…å®¹ï¼Œæ‰€æœ‰ç›´æ¥ç”¨ <code>IDEA</code> åšäº†å­—èŠ‚ç çš„è§£æ)</p>
<p><strong>é¦–å…ˆå±•ç¤ºçš„éœ€è¦è¿›è¡Œå¢å¼ºçš„ SampleClass çš„å…·ä½“å†…å®¹</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç”¨äºå¢å¼ºçš„ç®€å•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">    enhancer.setSuperclass(SampleClass.class);</span><br><span class="line">    enhancer.setCallback(<span class="keyword">new</span> FixedValue() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">loadObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Hello cglib!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    SampleClass proxy = (SampleClass) enhancer.create();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åŠ¨æ€ç”Ÿæˆçš„æ–°çš„ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ç”¨è¿‡å¤šå…³æ³¨ï¼Œåªæ˜¯ CGlib ä¿è¯ç”Ÿæˆç±»ä¸åŸæœ‰çš„ç±»ä¸€å®šå±äºåŒä¸€åŒ…ä¸‹ï¼Œå·æ‡’ç›´æ¥æŠŠ SampleClass å†™åœ¨ CGlib é¡¹ç›®é‡Œäº†</span></span><br><span class="line"><span class="keyword">package</span> net.sf.cglib.samples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Callback;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Factory;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.FixedValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°çš„ç±»åï¼Œé€šè¿‡ $$EnhancerByCGLIB ä»¥åŠ $$7cd64b81(è¿™ä¸ªæ˜¯å“ˆå¸Œå€¼) å¯¹ç±»åè¿›è¡Œå”¯ä¸€åŒºåˆ† </span></span><br><span class="line"><span class="comment"> * å¦‚æœè¿˜æ˜¯é‡å¤äº†ï¼Œåœ¨åŠ¨æ€ç”Ÿæˆå‰ä¼šè¿›è¡Œç±»åçš„æ£€æµ‹ï¼Œå¹¶é€šè¿‡å¢åŠ åºå· "_&lt;index&gt;" çš„å½¢å¼è¿›è¡Œè¿›ä¸€æ­¥åŒºåˆ†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¯ä»¥çœ‹åˆ°æ–°ç”Ÿæˆçš„ç±»ç»§æ‰¿äº† SampleClass </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleClass</span>$$<span class="title">EnhancerByCGLIB</span>$$7<span class="title">cd64b81</span> <span class="keyword">extends</span> <span class="title">SampleClass</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> CGLIB$BOUND;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object CGLIB$FACTORY_DATA;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal CGLIB$THREAD_CALLBACKS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Callback[] CGLIB$STATIC_CALLBACKS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šä¸€ä¸ªåœ¨å¢å¼ºä¸­å£°æ˜çš„ Callback å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> FixedValue CGLIB$CALLBACK_0;</span><br><span class="line">    <span class="comment">// ç»‘å®šä¸€ä¸ªé™æ€çš„å›è°ƒè°ƒåº¦å®ä¾‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object CGLIB$CALLBACK_FILTER;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> CGLIB$STATICHOOK1() &#123;</span><br><span class="line">        CGLIB$THREAD_CALLBACKS = <span class="keyword">new</span> ThreadLocal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * å¯¹ test(String) çš„æ–¹æ³•çš„å¢å¼º</span></span><br><span class="line"><span class="comment">      */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">test</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åœ¨æ–¹æ³•å—ä¸­æ‹¿åˆ° Callback å®ä¾‹</span></span><br><span class="line">        FixedValue var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        <span class="comment">// ä¸ºç©ºåˆ™å°è¯•è·å–</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§¦å‘å›è°ƒå®ä¾‹çš„æ–¹æ³•è·å¾—è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">return</span> (String)var10000.loadObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * ç”±äºæ­¤æ¬¡å¢å¼ºåªå£°æ˜äº†ä¸€ä¸ª Callback</span></span><br><span class="line"><span class="comment">      * å› æ­¤æ‰€æœ‰æ–¹æ³•çš„å¢å¼ºéƒ½ç›¸åŒ, éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå›è°ƒæ–¹æ³•è·å–</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> </span>&#123;</span><br><span class="line">        FixedValue var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object var2 = var10000.loadObject();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä½†æ˜¯ï¼Œæ­¤å¤„ä¼šå°è¯•å¼ºåˆ¶è½¬å‹</span></span><br><span class="line"><span class="comment">         * åŒæ—¶åœ¨æœ€ç»ˆæ‰§è¡Œå¤±è´¥çš„æ—¶å€™ç›´æ¥æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</span></span><br><span class="line"><span class="comment">         * æ¯•ç«Ÿä¸Šé¢å¢å¼ºçš„æ—¶å€™è¿”å›å›ºå®šå€¼ "Hello, cglib!"</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> var2 == <span class="keyword">null</span> ? <span class="keyword">false</span> : (Boolean)var2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FixedValue var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (String)var10000.loadObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FixedValue var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object var1 = var10000.loadObject();</span><br><span class="line">        <span class="keyword">return</span> var1 == <span class="keyword">null</span> ? <span class="number">0</span> : ((Number)var1).intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        FixedValue var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> var10000.loadObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81() &#123;</span><br><span class="line">        CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> CGLIB$SET_THREAD_CALLBACKS(Callback[] var0) &#123;</span><br><span class="line">        CGLIB$THREAD_CALLBACKS.set(var0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> CGLIB$SET_STATIC_CALLBACKS(Callback[] var0) &#123;</span><br><span class="line">        CGLIB$STATIC_CALLBACKS = var0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> CGLIB$BIND_CALLBACKS(Object var0) &#123;</span><br><span class="line">        SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81 var1 = (SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81)var0;</span><br><span class="line">        <span class="keyword">if</span> (!var1.CGLIB$BOUND) &#123;</span><br><span class="line">            var1.CGLIB$BOUND = <span class="keyword">true</span>;</span><br><span class="line">            Object var10000 = CGLIB$THREAD_CALLBACKS.get();</span><br><span class="line">            <span class="keyword">if</span> (var10000 == <span class="keyword">null</span>) &#123;</span><br><span class="line">                var10000 = CGLIB$STATIC_CALLBACKS;</span><br><span class="line">                <span class="keyword">if</span> (CGLIB$STATIC_CALLBACKS == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            var1.CGLIB$CALLBACK_0 = (FixedValue)((Callback[])var10000)[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(Callback[] var1)</span> </span>&#123;</span><br><span class="line">        CGLIB$SET_THREAD_CALLBACKS(var1);</span><br><span class="line">        SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81 var10000 = <span class="keyword">new</span> SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81();</span><br><span class="line">        CGLIB$SET_THREAD_CALLBACKS((Callback[])<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> var10000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(Callback var1)</span> </span>&#123;</span><br><span class="line">        CGLIB$SET_THREAD_CALLBACKS(<span class="keyword">new</span> Callback[]&#123;var1&#125;);</span><br><span class="line">        SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81 var10000 = <span class="keyword">new</span> SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81();</span><br><span class="line">        CGLIB$SET_THREAD_CALLBACKS((Callback[])<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> var10000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(Class[] var1, Object[] var2, Callback[] var3)</span> </span>&#123;</span><br><span class="line">        CGLIB$SET_THREAD_CALLBACKS(var3);</span><br><span class="line">        SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81 var10000 = <span class="keyword">new</span> SampleClass$$EnhancerByCGLIB$$<span class="number">7</span>cd64b81;</span><br><span class="line">        <span class="keyword">switch</span>(var1.length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            var10000.&lt;init&gt;();</span><br><span class="line">            CGLIB$SET_THREAD_CALLBACKS((Callback[])<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> var10000;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Constructor not found"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Callback <span class="title">getCallback</span><span class="params">(<span class="keyword">int</span> var1)</span> </span>&#123;</span><br><span class="line">        CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">        FixedValue var10000;</span><br><span class="line">        <span class="keyword">switch</span>(var1) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            var10000 = <span class="keyword">this</span>.CGLIB$CALLBACK_0;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            var10000 = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> var10000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallback</span><span class="params">(<span class="keyword">int</span> var1, Callback var2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(var1) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">this</span>.CGLIB$CALLBACK_0 = (FixedValue)var2;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Callback[] getCallbacks() &#123;</span><br><span class="line">        CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Callback[]&#123;<span class="keyword">this</span>.CGLIB$CALLBACK_0&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallbacks</span><span class="params">(Callback[] var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.CGLIB$CALLBACK_0 = (FixedValue)var1[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        CGLIB$STATICHOOK1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç”Ÿæˆç±»å¯ä»¥çœ‹å‡ºæ¥ï¼ŒCGlib æ‰€è¿›è¡Œçš„å¢å¼ºï¼Œæ˜¯åœ¨ä¸ç›´æ¥å¯¹åŸæœ‰çš„æ–¹æ³•ä½“å†…å®¹è¿›è¡Œæ”¹é€ çš„åŸºç¡€ä¸Š(ä¾‹å¦‚ä¸Šé¢çš„ test(String) æ–¹æ³•ï¼Œæ²¡æœ‰ç›´æ¥æ”¹å†™æˆ <code>return &quot;Hello, cglib!</code> çš„å½¢å¼)ï¼Œå¯¹æ–¹æ³•æ‰§è¡Œä¹‹å‰å…¥å‚æˆ–è€…æ–¹æ³•æ‰§è¡Œä¹‹åçš„è¿”å›å€¼è¿›è¡Œä¸€å®šçš„å¤„ç†ã€‚</p>
<p>ä¸»è¦ä½¿ç”¨çš„å½¢å¼å°±æ˜¯å°†å›è°ƒå®ä¾‹ä¸åŸæœ‰æ–¹æ³•è¿›è¡Œç»‘å®šï¼Œå¹¶é€šè¿‡è°ƒç”¨å›è°ƒæ–¹æ³•æ¥å®ç°æ–¹æ³•çš„å¢å¼ºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  __                    __                  </span><br><span class="line"> / _| __ _ _ __   __ _ / _| ___ _ __   __ _ </span><br><span class="line">| |_ / _` | &apos;_ \ / _` | |_ / _ \ &apos;_ \ / _` |</span><br><span class="line">|  _| (_| | | | | (_| |  _|  __/ | | | (_| |</span><br><span class="line">|_|  \__,_|_| |_|\__, |_|  \___|_| |_|\__, |</span><br><span class="line">                 |___/                |___/</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>åŸæ–‡ä½œè€…: </span>
      <a href="https://DorMOUSE-None.github.io">Utop</a>
    </p>
    <p class="copyright-item">
      <span>åŸæ–‡é“¾æ¥: </span>
      <a href="https://DorMOUSE-None.github.io/2018-07-10-CGlib-Enhancer/">https://DorMOUSE-None.github.io/2018-07-10-CGlib-Enhancer/</a>
    </p>
    <p class="copyright-item">
      <span>è®¸å¯åè®®: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/ASM/">ASM</a>
            
              <a href="/tags/CGlib/">CGlib</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018-07-13-How-to-easily-get-CGlib-generated-code/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">å¦‚ä½•æ–¹ä¾¿åœ°è·å– CGlib ç”Ÿæˆç±»</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2018-07-04-JDK-Permission/">
        <span class="next-text nav-default">Java å®‰å…¨è®¿é—®ä¸æƒé™æ§åˆ¶</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:dormousenone@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/DorMOUSE-None" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2018 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Utop</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://DorMOUSE-None.github.io/2018-07-10-CGlib-Enhancer/';
        this.page.identifier = '2018-07-10-CGlib-Enhancer/';
        this.page.title = 'CGlib Enhancer ä¸»æµç¨‹æºç è§£æ';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//utop-blog.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.9.0"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  </body>
</html>
